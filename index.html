<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω B√†i T·∫≠p Do VanQuan Thi·∫øt K·∫ø</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

    <!-- Firebase SDK (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --accent: #38b6ff;
            --accent-glow: rgba(56, 182, 255, 0.3);
            --accent-hover: #0ea5e9;
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --glass-border: rgba(56, 182, 255, 0.2);
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Outfit', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 1rem;
            position: relative;
            overflow-x: hidden;
            /* Lo·∫°i b·ªè transform animation ·ªü body ƒë·ªÉ position: fixed ho·∫°t ƒë·ªông chu·∫©n */
            animation: simpleFadeIn 1s forwards;
        }

        @keyframes simpleFadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* VIP Themes - Restored */
        body.theme-rose {
            --accent: #ec4899;
            --accent-glow: rgba(236, 72, 153, 0.3);
            --accent-hover: #db2777;
        }

        body.theme-emerald {
            --accent: #10b981;
            --accent-glow: rgba(16, 185, 129, 0.3);
            --accent-hover: #059669;
        }

        body.theme-amber {
            --accent: #f59e0b;
            --accent-glow: rgba(245, 158, 11, 0.3);
            --accent-hover: #d97706;
        }

        /* Cyber Grid Background from TrungTamMMO */
        #cyber-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            opacity: 0.2;
            background-image:
                linear-gradient(rgba(56, 182, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(56, 182, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        .bg-overlay {
            position: fixed;
            top: -5%;
            left: -5%;
            width: 110%;
            height: 110%;
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            z-index: -1;
            transition: transform 0.15s ease-out;
            pointer-events: none;
        }

        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            /* Ensure centering */
            padding: 0 1.5rem;
            /* Prevent edge touching */
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
        }

        header h1 {
            font-size: 2.5rem;
            font-weight: 600;
            background: linear-gradient(to right, #6366f1, #ec4899);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        header p {
            color: var(--text-secondary);
        }

        /* Input Form */
        .input-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            padding: 2rem;
            border-radius: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .form-group {
            display: grid;
            grid-template-columns: 2fr 1fr 120px 100px;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-row-2 {
            display: flex;
            justify-content: center;
            gap: 1rem;
            align-items: center;
        }

        textarea {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 0.8rem 1rem;
            border-radius: 0.75rem;
            color: white;
            outline: none;
            transition: border-color 0.3s;
            grid-column: span 4;
            resize: vertical;
            min-height: 80px;
        }

        textarea:focus {
            border-color: var(--accent);
        }

        @media (max-width: 600px) {
            .form-group {
                grid-template-columns: 1fr;
            }
        }

        input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 0.8rem 1rem;
            border-radius: 0.75rem;
            color: white;
            outline: none;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: var(--accent);
        }

        button.add-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        button.add-btn:hover {
            background: var(--accent-hover);
            transform: scale(1.02);
        }

        /* User Profile Buttons */
        .logout-btn {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid var(--danger);
            padding: 0.4rem 0.8rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: 0.3s;
            font-size: 0.8rem;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
        }

        .settings-btn {
            background: rgba(56, 182, 255, 0.1);
            color: var(--accent);
            border: 1px solid var(--accent);
            padding: 0.4rem 0.8rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: 0.3s;
            font-size: 0.8rem;
        }

        .settings-btn:hover {
            background: var(--accent);
            color: white;
        }

        /* Task List */
        .list-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .task-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            padding: 1.2rem 1.5rem;
            border-radius: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .task-info h3 {
            font-size: 1.1rem;
            margin-bottom: 0.2rem;
            transition: color 0.3s;
        }

        .task-info p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .task-image-preview {
            width: 80px;
            height: 60px;
            border-radius: 0.5rem;
            object-fit: cover;
            margin-right: 1rem;
            border: 1px solid var(--glass-border);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .task-image-preview:hover {
            transform: scale(1.1);
        }

        .task-left {
            display: flex;
            align-items: center;
        }

        .image-input-label {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 0.8rem;
            border-radius: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }

        .image-input-label:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent);
        }

        .image-input-label span {
            font-size: 1.2rem;
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
        }

        .search-container {
            margin-bottom: 2rem;
            position: relative;
        }

        .search-input {
            width: 100%;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            padding: 1.2rem 1.5rem;
            border-radius: 1.25rem;
            color: white;
            outline: none;
            backdrop-filter: blur(15px);
            transition: 0.3s;
            font-size: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .search-input:focus {
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-star {
            background: rgba(234, 179, 8, 0.1);
            color: #eab308;
            font-size: 1.2rem;
        }

        .btn-star.active {
            background: #eab308;
            color: black;
        }

        .task-card.starred {
            border: 1px solid rgba(234, 179, 8, 0.5);
            box-shadow: 0 0 20px rgba(234, 179, 8, 0.15);
            background: rgba(30, 25, 10, 0.85);
        }

        /* Dashboard Stats */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            padding: 1.5rem;
            border-radius: 1.25rem;
            text-align: center;
            transition: 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            display: block;
            margin-bottom: 0.2rem;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .progress-container {
            grid-column: span 3;
            background: rgba(255, 255, 255, 0.05);
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--accent), #ec4899);
            width: 0%;
            transition: width 0.8s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }

        .btn-action {
            width: 38px;
            height: 38px;
            border-radius: 0.5rem;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            color: white;
        }

        .btn-done {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .btn-done:hover {
            background: var(--success);
            color: white;
        }

        .btn-delete {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .btn-delete:hover {
            background: var(--danger);
            color: white;
        }

        /* Status Finished */
        .task-card.completed {
            opacity: 0.6;
        }

        .task-card.completed .task-info h3 {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .task-card.completed .btn-done {
            background: var(--success);
            color: white;
        }

        /* Empty State */
        #empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-primary);
            font-weight: 600;
            font-style: italic;
        }

        /* VIP Ultimate Elements */
        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .quote-container {
            text-align: center;
            margin-bottom: 2rem;
            font-style: italic;
            opacity: 0.8;
            font-size: 1rem;
            color: var(--accent);
            animation: pulse 4s infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            width: 100%;
        }

        .quote-container::before {
            content: '‚Äú';
            font-size: 1.5rem;
            opacity: 0.5;
        }

        .quote-container::after {
            content: '‚Äù';
            font-size: 1.5rem;
            opacity: 0.5;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.6;
            }

            50% {
                opacity: 1;
            }
        }

        /* Task Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(15px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            padding: 2.5rem;
            border-radius: 2rem;
            max-width: 600px;
            width: 90%;
            position: relative;
            box-shadow: 0 0 50px rgba(99, 102, 241, 0.2);
        }

        .close-modal {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        /* Tabs System */
        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            justify-content: center;
        }

        .task-card.urgent {
            border-color: var(--danger);
            animation: urgent-pulse 2s infinite ease-in-out;
        }

        @keyframes urgent-pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }

            70% {
                box-shadow: 0 0 0 15px rgba(239, 68, 68, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        .action-btns {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .tab-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 0.8rem 2rem;
            border-radius: 2rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: 0.3s;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .tab-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Guide Section Styling */
        .guide-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            padding: 2.5rem;
            border-radius: 2rem;
            line-height: 1.8;
        }

        .guide-item {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .guide-item h3 {
            color: var(--accent);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .guide-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .guide-step {
            background: rgba(255, 255, 255, 0.03);
            padding: 1rem;
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Welcome Overlay */
        .welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            z-index: 30000;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: 0.8s ease;
        }

        .welcome-content {
            padding: 3rem;
            max-width: 600px;
            animation: welcomePop 1s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }

        @keyframes welcomePop {
            0% {
                opacity: 0;
                transform: scale(0.95);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Cyberpunk Clock Styles */
        .cyber-clock-wrapper {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            margin-bottom: 2rem;
            margin-top: 1rem;
        }

        .clock-box {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--accent);
            border-radius: 1rem;
            padding: 1rem;
            min-width: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 0 15px rgba(56, 182, 255, 0.2);
            backdrop-filter: blur(5px);
        }

        .clock-digit {
            font-family: 'Courier New', monospace;
            /* Fallback monospace */
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent);
            text-shadow: 0 0 10px var(--accent-glow);
            line-height: 1;
        }

        .clock-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 0.5rem;
            color: var(--text-secondary);
        }

        .cyber-date-container {
            background: linear-gradient(90deg, transparent 0%, rgba(56, 182, 255, 0.1) 50%, transparent 100%);
            border-top: 1px solid rgba(56, 182, 255, 0.3);
            border-bottom: 1px solid rgba(56, 182, 255, 0.3);
            display: inline-block;
            padding: 0.5rem 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(5px);
        }

        .cyber-date-text {
            color: white;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--accent-glow);
            font-weight: 500;
        }

        /* Settings Modal Form Styling */
        .settings-section {
            margin-bottom: 1rem;
        }

        .settings-form-group {
            margin-bottom: 1.2rem;
            /* Gi·∫£m nh·∫π ƒë·ªÉ ti·∫øt ki·ªám di·ªán t√≠ch */
            display: grid;
            grid-template-columns: 150px 1fr;
            /* Thu h·∫πp nh√£n m·ªôt ch√∫t */
            align-items: center;
            gap: 1rem;
            width: 100%;
        }

        .settings-form-group label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
            text-align: left;
            line-height: 1.2;
        }

        .settings-form-group input {
            width: 100%;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 0.8rem;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            outline: none;
        }

        /* ƒê·∫∑c tr·ªã cho h√†ng c√≥ ch√∫ th√≠ch (Avatar) */
        /* ƒê·∫∑c tr·ªã cho h√†ng c√≥ ch√∫ th√≠ch (Avatar) */
        .settings-form-group.has-description {
            align-items: start;
        }

        .settings-form-group.has-description label {
            margin-top: 12px;
        }

        .settings-form-group input:focus {
            border-color: var(--accent);
            background: rgba(15, 23, 42, 0.9);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        /* Modal Instant Show Override */
        #otpModal {
            display: none;
            /* Default hidden */
            transition: none;
            /* Remove transition delay */
            animation: fadeIn 0.1s ease-out;
            /* Super fast animation */
        }

        .welcome-content h2 {
            font-size: 1.5rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 1rem;
        }

        .welcome-content h1 {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            background: linear-gradient(to right, #fff, var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .btn-start {
            background: var(--accent);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 3rem;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.4);
        }

        .btn-start:hover {
            transform: scale(1.1);
            box-shadow: 0 0 50px rgba(99, 102, 241, 0.6);
            background: white;
            color: var(--accent);
        }

        /* Pomodoro & Extra Tools */
        .pomodoro-card {
            background: var(--card-bg);
            border: 1px solid var(--accent-glow);
            padding: 1.5rem;
            border-radius: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-around;
            animation: fadeIn 0.8s ease;
        }

        .pomo-time {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: monospace;
            color: var(--accent);
            text-shadow: 0 0 10px var(--accent-glow);
            margin-bottom: 0.5rem;
        }

        .pomo-presets {
            display: flex;
            gap: 5px;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .preset-btn {
            font-size: 0.75rem !important;
            padding: 0.3rem 0.6rem !important;
            opacity: 0.7;
        }

        .preset-btn.active {
            opacity: 1;
            background: var(--accent) !important;
        }

        .pomo-controls button {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            margin: 0 0.2rem;
            cursor: pointer;
            transition: 0.3s;
        }

        .pomo-controls button:hover {
            background: var(--accent);
        }

        .badge-urgent {
            background: #ef4444;
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 0.5rem;
            font-size: 0.7rem;
            font-weight: 700;
            margin-left: 0.5rem;
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        .theme-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 2rem;
        }

        .theme-dot {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            transition: 0.3s;
        }

        .theme-dot:hover {
            transform: scale(1.2);
        }

        .backup-tools {

            .admin-table th,
            .admin-table td {
                padding: 1.2rem;
                text-align: left;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }

            .admin-table th {
                background: rgba(255, 255, 255, 0.05);
                color: var(--accent);
                text-transform: uppercase;
                font-size: 0.8rem;
                letter-spacing: 1px;
            }

            .admin-table tr:hover {
                background: rgba(255, 255, 255, 0.02);
            }

            .role-badge {
                padding: 0.2rem 0.6rem;
                border-radius: 0.5rem;
                font-size: 0.7rem;
                font-weight: 700;
            }

            .role-admin {
                background: var(--accent);
                color: white;
            }

            .role-user {
                background: rgba(255, 255, 255, 0.1);
                color: var(--text-secondary);
            }

            .btn-delete-user {
                background: rgba(239, 68, 68, 0.1);
                color: var(--danger);
                border: 1px solid var(--danger);
                padding: 0.4rem 0.8rem;
                border-radius: 0.5rem;
                cursor: pointer;
                transition: 0.3s;
            }

            .btn-delete-user:hover {
                background: var(--danger);
                color: white;
            }
        }

        /* Admin Dashboard Styles */
        .admin-dashboard {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid var(--glass-border);
            text-align: center;
            /* Center align container content */
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            color: var(--text-primary);
            margin-top: 1rem;
            margin-left: auto;
            /* Center table */
            margin-right: auto;
            /* Center table */
        }

        .admin-table th,
        .admin-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--glass-border);
            text-align: center;
            /* Center align table cells */
        }

        .action-btns {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 1rem;
        }

        .action-btns button {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: 0.3s;
        }

        .action-btns button:hover {
            background: var(--accent);
        }

        /* Auth Portal */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(15px);
            z-index: 9000;
            /* Lower than OTP Modal (10002) */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .auth-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            padding: 3rem;
            border-radius: 2.5rem;
            width: calc(100% - 2rem);
            max-width: 400px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: welcomePop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .auth-card h2 {
            margin-bottom: 2rem;
            font-size: 1.8rem;
            background: linear-gradient(to right, #fff, var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .auth-input {
            width: 100%;
            display: block;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 1rem 1.2rem;
            border-radius: 1rem;
            color: white;
            margin-bottom: 1rem;
            outline: none;
            transition: 0.3s;
            text-align: left;
        }

        .auth-input:focus {
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .auth-toggle {
            margin-top: 1.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .auth-toggle span {
            color: var(--accent);
            cursor: pointer;
            text-decoration: underline;
            font-weight: 600;
        }

        .password-wrapper {
            position: relative;
            width: 100%;
            margin-bottom: 1rem;
        }

        .password-wrapper .auth-input {
            margin-bottom: 0;
            padding-right: 3.5rem;
        }

        .toggle-password {
            position: absolute;
            right: 1.2rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            transition: 0.3s;
            user-select: none;
            z-index: 5;
        }

        .toggle-password:hover {
            color: var(--accent);
        }

        /* User Profile VIP */
        .user-profile {
            position: fixed;
            top: 1.5rem;
            right: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.6rem 1.2rem;
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 5rem;
            z-index: 15000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-left: 3px solid var(--accent);
        }

        .user-profile:hover {
            background: rgba(30, 30, 30, 0.8);
            transform: scale(1.05) translateY(-2px);
            border-color: var(--accent);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.2);
        }

        .avatar {
            width: 38px;
            height: 38px;
            background: linear-gradient(135deg, var(--accent), #ec4899);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px var(--accent-glow);
            flex-shrink: 0;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        #headerUsername {
            font-weight: 700;
            font-size: 0.85rem;
            color: white;
            white-space: nowrap;
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 0.7rem;
            cursor: pointer;
            padding: 0;
            text-align: left;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: 0.3s;
            font-weight: 600;
            margin-top: 2px;
        }

        .logout-btn:hover {
            color: var(--danger);
            letter-spacing: 1.5px;
        }

        @media (max-width: 768px) {
            .user-profile {
                top: 0.8rem;
                right: 0.8rem;
                padding: 0.4rem 0.8rem;
                gap: 0.6rem;
            }

            #headerUsername {
                display: none;
            }

            .logout-btn {
                font-size: 0.65rem;
            }

            .music-player-container {
                top: 4.5rem;
                right: 0.8rem;
            }
        }

        /* Music Player VIP */
        .music-player-container {
            position: fixed;
            top: 5.5rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.5rem;
            z-index: 15000;
        }

        .music-info-badge {
            background: rgba(var(--accent-rgb, 99, 102, 241), 0.15);
            backdrop-filter: blur(10px);
            padding: 0.3rem 0.8rem;
            border-radius: 2rem;
            font-size: 0.7rem;
            color: var(--accent);
            border: 1px solid var(--accent-glow);
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            transform: translateY(10px);
            transition: 0.4s;
            pointer-events: none;
        }

        .music-player-container.playing .music-info-badge {
            opacity: 1;
            transform: translateY(0);
        }

        .music-controls-wrapper {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            background: rgba(20, 20, 20, 0.4);
            backdrop-filter: blur(20px);
            padding: 0.4rem;
            border-radius: 5rem;
            border: 1px solid var(--glass-border);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .music-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.1rem;
            transition: 0.3s;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .music-btn:hover {
            color: var(--accent);
            background: rgba(255, 255, 255, 0.05);
        }

        .music-toggle-main {
            width: 42px;
            height: 42px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: white;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px var(--accent-glow);
        }

        .music-toggle-main:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }

        .music-toggle-main.playing {
            animation: pulse-music 2s infinite;
        }

        @keyframes pulse-music {
            0% {
                box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(99, 102, 241, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(99, 102, 241, 0);
            }
        }

        .music-waves {
            display: none;
            gap: 2px;
            align-items: flex-end;
            height: 12px;
            margin-left: 2px;
        }

        .playing .music-waves {
            display: flex;
        }

        .music-waves span {
            width: 2px;
            background: var(--accent);
            border-radius: 1px;
            animation: wave 1s ease-in-out infinite;
        }

        .music-waves span:nth-child(2) {
            height: 100%;
            animation-delay: 0.2s;
        }

        .music-waves span:nth-child(1) {
            height: 60%;
            animation-delay: 0.1s;
        }

        .music-waves span:nth-child(3) {
            height: 80%;
            animation-delay: 0.3s;
        }

        @keyframes wave {

            0%,
            100% {
                transform: scaleY(1);
            }

            50% {
                transform: scaleY(0.4);
            }
        }

        @media (max-width: 600px) {
            .music-player-container {
                top: 5rem;
                right: 1.2rem;
            }
        }

        /* Stats Tab VIP Styles */
        .stats-grid-vip {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: 0.3s;
        }

        .chart-card:hover {
            border-color: var(--accent-glow);
            transform: translateY(-5px);
        }

        .chart-card h3 {
            font-size: 1rem;
            margin-bottom: 1.5rem;
            color: var(--text-secondary);
            text-align: center;
        }

        .productivity-summary {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(16, 185, 129, 0.1));
            border-radius: 1.5rem;
            padding: 1.5rem;
            border: 1px solid var(--accent-glow);
            text-align: center;
            line-height: 1.6;
        }

        /* Deep Work Mode - Hidden Distractions */
        body.deep-work-active .input-card,
        body.deep-work-active .dashboard-grid,
        body.deep-work-active .search-container,
        body.deep-work-active .list-container,
        body.deep-work-active .nav-tabs,
        body.deep-work-active .quote-container,
        body.deep-work-active footer,
        body.deep-work-active .user-profile {
            opacity: 0;
            pointer-events: none;
            height: 0;
            overflow: hidden;
            margin: 0 !important;
            padding: 0 !important;
            transition: all 0.5s ease;
        }

        body.deep-work-active .pomodoro-card {
            transform: scale(1.05);
            margin-top: 5vh;
            border-color: var(--accent);
            box-shadow: 0 0 100px rgba(56, 182, 255, 0.15);
            transition: all 0.5s ease;
        }

        body.deep-work-active header h1,
        body.deep-work-active header p {
            opacity: 0.3;
            filter: blur(2px);
            transition: 0.5s;
        }

        body.deep-work-active header:hover h1,
        body.deep-work-active header:hover p {
            opacity: 1;
            filter: none;
        }

        /* Admin Contact Styles */
        .admin-contact-footer {
            margin-top: 3rem;
            text-align: center;
            padding: 2rem;
            border-top: 1px solid var(--glass-border);
            width: 100%;
            max-width: 800px;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
        }

        .social-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: 0.3s;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid transparent;
        }

        .social-item:hover {
            color: var(--accent);
            background: rgba(56, 182, 255, 0.1);
            border-color: var(--accent-glow);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px var(--accent-glow);
        }

        .social-item i {
            font-size: 1.2rem;
        }

        /* Mobile Responsive Overrides */
        @media (max-width: 768px) {
            body {
                padding: 1rem 0.5rem;
            }

            header h1 {
                font-size: 1.8rem;
                padding: 0 1rem;
                line-height: 1.3;
            }

            .cyber-clock-wrapper {
                gap: 0.8rem;
                margin-bottom: 1.5rem;
            }

            .clock-box {
                min-width: 60px;
                padding: 0.6rem;
            }

            .clock-digit {
                font-size: 1.6rem;
            }

            .nav-tabs {
                gap: 0.5rem;
                flex-wrap: nowrap;
                overflow-x: auto;
                justify-content: flex-start;
                padding: 0.5rem 1rem;
                -webkit-overflow-scrolling: touch;
                width: 100vw;
                margin-left: -0.5rem;
            }

            .tab-btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.85rem;
                white-space: nowrap;
                flex-shrink: 0;
            }

            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.8rem;
            }

            .progress-container {
                grid-column: span 2;
            }

            .input-card {
                padding: 1.2rem;
            }

            .form-group {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }

            textarea {
                grid-column: span 1;
            }

            .settings-form-group {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .settings-form-group label {
                margin-bottom: 0.2rem;
            }

            .modal-content {
                padding: 1.5rem;
                width: 95%;
            }

            .task-card {
                padding: 1rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .task-actions {
                width: 100%;
                justify-content: flex-end;
                border-top: 1px solid var(--glass-border);
                padding-top: 0.8rem;
            }

            .stats-grid-vip {
                grid-template-columns: 1fr;
            }

            .pomodoro-card {
                flex-direction: column;
                gap: 1.5rem;
                padding: 1.2rem;
            }
        }
    </style>
</head>

<body>
    <!-- Auth Portal -->
    <div id="authPortal" class="auth-overlay" style="display: none;">
        <div class="auth-card" id="loginForm">
            <h2>ƒêƒÉng Nh·∫≠p VIP</h2>
            <input type="text" id="loginUser" class="auth-input" placeholder="T√™n ƒëƒÉng nh·∫≠p...">
            <div class="password-wrapper">
                <input type="password" id="loginPass" class="auth-input" placeholder="M·∫≠t kh·∫©u...">
                <span class="toggle-password" onclick="togglePassword('loginPass', this)">üëÅÔ∏è</span>
            </div>
            <div style="text-align: right; margin-bottom: 1.5rem; margin-top: -0.5rem;">
                <span
                    style="color: var(--text-secondary); font-size: 0.85rem; cursor: pointer; text-decoration: underline;"
                    onclick="toggleAuth('forgot')">Qu√™n m·∫≠t kh·∫©u?</span>
            </div>
            <button class="btn-start" style="width: 100%;" onclick="handleLogin()">ƒêƒÉng Nh·∫≠p</button>
            <div class="auth-toggle">Ch∆∞a c√≥ t√†i kho·∫£n? <span onclick="toggleAuth('register')">ƒêƒÉng k√Ω ngay</span></div>
        </div>
        <div class="auth-card" id="registerForm" style="display: none;">
            <h2>ƒêƒÉng K√Ω Th√†nh Vi√™n</h2>
            <input type="text" id="regUser" class="auth-input" placeholder="T√™n ƒëƒÉng nh·∫≠p...">
            <input type="email" id="regEmail" class="auth-input" placeholder="Email nh·∫≠n m√£ b·∫£o m·∫≠t...">
            <div class="password-wrapper">
                <input type="password" id="regPass" class="auth-input" placeholder="M·∫≠t kh·∫©u b·∫£o m·∫≠t...">
                <span class="toggle-password" onclick="togglePassword('regPass', this)">üëÅÔ∏è</span>
            </div>
            <div class="password-wrapper">
                <input type="password" id="regConfirmPass" class="auth-input" placeholder="X√°c nh·∫≠n l·∫°i m·∫≠t kh·∫©u...">
                <span class="toggle-password" onclick="togglePassword('regConfirmPass', this)">üëÅÔ∏è</span>
            </div>
            <button class="btn-start" style="width: 100%;" onclick="handleRegister()">T·∫°o T√†i Kho·∫£n</button>
            <div class="auth-toggle">ƒê√£ c√≥ t√†i kho·∫£n? <span onclick="toggleAuth('login')">Quay l·∫°i ƒêƒÉng nh·∫≠p</span>
            </div>
        </div>
        <div class="auth-card" id="forgotForm" style="display: none;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üîë</div>
            <h2>Kh√¥i Ph·ª•c M·∫≠t Kh·∫©u</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9rem;">
                Nh·∫≠p Email b·∫°n ƒë√£ d√πng ƒë·ªÉ ƒëƒÉng k√Ω t√†i kho·∫£n.
            </p>
            <input type="email" id="forgotEmail" class="auth-input" placeholder="Email c·ªßa b·∫°n...">
            <button class="btn-start" style="width: 100%;" onclick="handleForgotPassword()">G·ª≠i M√£ X√°c Th·ª±c</button>
            <div class="auth-toggle" onclick="toggleAuth('login')"><span>Quay l·∫°i ƒêƒÉng nh·∫≠p</span></div>
        </div>
        <div class="auth-card" id="resetForm" style="display: none;">
            <h2>ƒê·∫∑t L·∫°i M·∫≠t Kh·∫©u</h2>
            <div class="password-wrapper">
                <input type="password" id="newPass" class="auth-input" placeholder="M·∫≠t kh·∫©u m·ªõi...">
                <span class="toggle-password" onclick="togglePassword('newPass', this)">üëÅÔ∏è</span>
            </div>
            <div class="password-wrapper">
                <input type="password" id="confirmNewPass" class="auth-input" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi...">
                <span class="toggle-password" onclick="togglePassword('confirmNewPass', this)">üëÅÔ∏è</span>
            </div>
            <button class="btn-start" style="width: 100%;" onclick="handleResetPassword()">C·∫≠p Nh·∫≠t M·∫≠t Kh·∫©u</button>
        </div>
        <div class="auth-card" id="verifyForm" style="display: none;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üõ°Ô∏è</div>
            <h2>X√°c Th·ª±c B·∫£o M·∫≠t</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9rem;" id="verifyMsg">
                M√£ x√°c th·ª±c ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n.
            </p>
            <input type="text" id="otpInput" class="auth-input" placeholder="Nh·∫≠p m√£ 6 ch·ªØ s·ªë..." maxlength="6"
                style="text-align: center; letter-spacing: 5px; font-weight: 700;">
            <button class="btn-start" style="width: 100%;" onclick="confirmOTP()">X√°c Nh·∫≠n</button>
            <div class="auth-toggle">C·∫£nh b√°o: ƒê√¢y l√† d·ª± √°n b·∫£o m·∫≠t VIP c·ªßa Qu√¢n</div>
        </div>
    </div>

    <!-- Welcome Overlay -->
    <div id="welcomeOverlay" class="welcome-overlay" style="display: none;">
        <div class="welcome-content">
            <h2>üéâ D·ª± √Ån ƒê·∫ßu Tay</h2>
            <h1>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi d·ª± √°n ƒë·∫ßu ti√™n c·ªßa Nguy·ªÖn VƒÉn Qu√¢n</h1>
            <p style="color: var(--text-secondary); margin-bottom: 3rem; line-height: 1.6;">
                Kh√°m ph√° ·ª©ng d·ª•ng qu·∫£n l√Ω b√†i t·∫≠p ƒë·∫≥ng c·∫•p VIP v·ªõi nh·ªØng t√≠nh nƒÉng ƒë·ªôc b·∫£n v√† giao di·ªán si√™u hi·ªán th·ª±c.
            </p>
            <button class="btn-start" onclick="closeWelcome()">Kh√°m Ph√° Ngay</button>
        </div>
    </div>

    <div id="particles-js" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;"></div>
    <div id="cyber-grid"></div>
    <div class="bg-overlay" id="bgLayer" style="display: none;"></div>

    <div class="user-profile" id="userHeader" style="display: none;" title="Qu·∫£n l√Ω t√†i kho·∫£n VIP">
        <div class="avatar" id="userAvatar">Q</div>
        <div class="user-info">
            <span id="headerUsername">H·ªá th·ªëng VIP</span>
            <div style="display: flex; gap: 0.5rem;">
                <button class="settings-btn" onclick="openSettings()" title="C√†i ƒë·∫∑t t√†i kho·∫£n">‚öôÔ∏è</button>
                <button class="logout-btn" onclick="handleLogout()">ƒêƒÉng xu·∫•t</button>
            </div>
        </div>
    </div>

    <!-- Custom OTP Modal -->
    <!-- Custom OTP Modal -->
    <div id="otpModal" class="modal" style="z-index: 10002;">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <h2 id="otpModalTitle" style="color: var(--accent); margin-bottom: 1rem;">üõ°Ô∏è X√°c Th·ª±c B·∫£o M·∫≠t</h2>
            <p id="otpModalMessage" style="margin-bottom: 1.5rem; color: var(--text-secondary); line-height: 1.6;"></p>
            <div class="action-btns" style="margin-top: 0;">
                <button class="btn-action" onclick="closeOTPModal()"
                    style="background: var(--accent); color: white; width: 100%;">ƒê√£ Hi·ªÉu</button>
            </div>
        </div>
    </div>

    <!-- User Settings Modal -->
    <div id="settingsModal" class="modal"
        style="z-index: 50000; display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(20px); justify-content: center; align-items: center; padding: 20px;">
        <div class="modal-content"
            style="position: relative; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; border: 2px solid var(--accent); box-shadow: 0 0 50px var(--accent-glow); margin: 0; background: #0f172a; border-radius: 1.5rem;">
            <h2
                style="color: var(--accent); margin-bottom: 1.5rem; text-align: center; text-transform: uppercase; letter-spacing: 2px;">
                üõ†Ô∏è C√†i ƒê·∫∑t T√†i Kho·∫£n</h2>

            <!-- Personal Info Section -->
            <div class="settings-section">
                <h3
                    style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 1px;">
                    üìù Th√¥ng Tin C√° Nh√¢n</h3>

                <div class="settings-form-group">
                    <label>T√™n Hi·ªÉn Th·ªã</label>
                    <input type="text" id="settingsDisplayName" placeholder="Nh·∫≠p t√™n m·ªõi..." />
                </div>

                <div class="settings-form-group">
                    <label>Avatar (Link ·∫£nh)</label>
                    <input type="text" id="settingsAvatarUrl" placeholder="https://link-anh-dai-dien.png" />
                </div>

                <div class="settings-form-group has-description">
                    <label>H√¨nh N·ªÅn (Link ·∫£nh)</label>
                    <div style="display: flex; flex-direction: column; width: 100%;">
                        <input type="text" id="settingsBgUrl" placeholder="https://link-anh-nen.jpg" />
                        <small
                            style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.7;">
                            D√°n link ·∫£nh (JPG/PNG) ƒë·ªÉ ƒë·ªïi h√¨nh n·ªÅn trang web. ƒê·ªÉ tr·ªëng ƒë·ªÉ d√πng m·∫∑c ƒë·ªãnh.
                        </small>
                    </div>
                </div>

                <button class="btn-action" onclick="updatePersonalInfo()" style="width: 100%; margin-top: 0.5rem;">C·∫≠p
                    Nh·∫≠t Th√¥ng Tin</button>
            </div>

            <hr style="border: none; border-top: 1px solid var(--glass-border); margin: 1.5rem 0;" />

            <!-- Security Section -->
            <div class="settings-section">
                <h3
                    style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 1px;">
                    üîê B·∫£o M·∫≠t</h3>

                <div class="settings-form-group">
                    <label>M·∫≠t Kh·∫©u Hi·ªán T·∫°i</label>
                    <input type="password" id="settingsOldPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u c≈©..." />
                </div>

                <div class="settings-form-group">
                    <label>M·∫≠t Kh·∫©u M·ªõi</label>
                    <input type="password" id="settingsNewPassword" placeholder="√çt nh·∫•t 1 hoa, 1 th∆∞·ªùng, 1 s·ªë" />
                </div>

                <div class="settings-form-group">
                    <label>X√°c Nh·∫≠n M·∫≠t Kh·∫©u M·ªõi</label>
                    <input type="password" id="settingsConfirmPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi..." />
                </div>

                <button class="btn-action" onclick="updatePassword()"
                    style="width: 100%; margin-top: 0.5rem; background: var(--danger);">ƒê·ªïi M·∫≠t Kh·∫©u</button>
            </div>

            <button class="btn-action" onclick="closeSettings()"
                style="width: 100%; margin-top: 1.5rem; background: rgba(255,255,255,0.1);">ƒê√≥ng</button>
        </div>
    </div>

    <!-- Music Player VIP -->
    <div class="music-player-container" id="musicPlayer">
        <div class="music-info-badge" id="musicTitle">ƒêang t·∫£i nh·∫°c...</div>
        <div class="music-controls-wrapper">
            <button class="music-btn" onclick="prevMusic()" title="B√†i tr∆∞·ªõc">‚èÆ</button>
            <div class="music-toggle-main" id="musicToggle" onclick="toggleMusic()" title="B·∫≠t/T·∫Øt nh·∫°c">
                <span id="musicIcon">üîá</span>
                <div class="music-waves">
                    <span></span><span></span><span></span>
                </div>
            </div>
            <button class="music-btn" onclick="nextMusic()" title="B√†i ti·∫øp">‚è≠</button>
        </div>
    </div>
    <audio id="bgMusic" onplay="handleMusicPlay()" onended="nextMusic()" onerror="handleAudioError()">
        <!-- Source s·∫Ω ƒë∆∞·ª£c ƒë·∫∑t b·∫±ng JS -->
    </audio>


    <div class="container" id="mainApp">
        <header>
            <p id="greeting-text"
                style="color: var(--accent); font-weight: 600; text-transform: uppercase; letter-spacing: 2px; font-size: 0.9rem; margin-bottom: 0.5rem;">
            </p>
            <h1>Qu·∫£n L√Ω B√†i T·∫≠p Do VanQuan Thi·∫øt K·∫ø</h1>

            <!-- Cyber Clock HTML -->
            <div class="cyber-clock-wrapper">
                <div class="clock-box">
                    <span class="clock-digit" id="clock-hours">00</span>
                    <span class="clock-label">GI·ªú</span>
                </div>
                <div class="clock-box">
                    <span class="clock-digit" id="clock-minutes">00</span>
                    <span class="clock-label">PH√öT</span>
                </div>
                <div class="clock-box">
                    <span class="clock-digit" id="clock-seconds">00</span>
                    <span class="clock-label">GI√ÇY</span>
                </div>
            </div>

            <div class="cyber-date-container">
                <p id="live-date" class="cyber-date-text">ƒêANG T·∫¢I...</p>
            </div>
            <div class="quote-container" id="quote-display">
                H·ªçc t·∫≠p l√† h·∫°t gi·ªëng c·ªßa ki·∫øn th·ª©c, ki·∫øn th·ª©c l√† h·∫°t gi·ªëng c·ªßa h·∫°nh ph√∫c.
            </div>
        </header>

        <nav class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('manager')">üìã Qu·∫£n L√Ω</button>
            <button class="tab-btn" onclick="switchTab('stats')">üìä Th·ªëng K√™</button>
            <button class="tab-btn" onclick="switchTab('guide')">üìñ H∆∞·ªõng D·∫´n</button>
            <button class="tab-btn" id="adminTabBtn" style="display: none;" onclick="switchTab('admin')">‚öôÔ∏è Qu·∫£n
                Tr·ªã</button>
        </nav>

        <div id="manager-tab" class="tab-content active">
            <section class="pomodoro-card">
                <div style="text-align: center;">
                    <span
                        style="font-size: 0.9rem; text-transform: uppercase; color: var(--accent); letter-spacing: 3px; display: block; margin-bottom: 1rem; font-weight: 600;">
                        TH·ªúI GIAN T·∫¨P TRUNG C·ª¶A B·∫†N
                    </span>
                    <div class="pomo-presets">
                        <button class="tab-btn preset-btn active" onclick="setPomoDuration(25, this)">25p</button>
                        <button class="tab-btn preset-btn" onclick="setPomoDuration(45, this)">45p</button>
                        <button class="tab-btn preset-btn" onclick="setPomoDuration(60, this)">60p</button>
                        <input type="number" id="customPomo" placeholder="Ph√∫t..."
                            style="width: 70px; background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border); color: white; border-radius: 0.5rem; padding: 2px 8px; font-size: 0.8rem;"
                            oninput="setPomoDuration(this.value, null)">
                    </div>
                    <div class="pomo-time" id="pomoDisplay">25:00</div>
                    <div class="pomo-controls">
                        <button onclick="togglePomo()" id="pomoStartBtn">B·∫ÆT ƒê·∫¶U</button>
                        <button onclick="resetPomo()">RESET</button>
                    </div>
                </div>
            </section>

            <section class="input-card">
                <div class="form-group">
                    <input type="text" id="taskName" placeholder="T√™n b√†i t·∫≠p..." required>
                    <input type="text" id="subject" placeholder="M√¥n h·ªçc (VƒÉn, To√°n...)">
                    <input type="date" id="dueDate">
                    <input type="time" id="dueTime">
                    <textarea id="taskContent" placeholder="N·ªôi dung chi ti·∫øt b√†i t·∫≠p..."></textarea>
                </div>
                <div class="form-row-2">
                    <label class="image-input-label" title="Th√™m ·∫£nh">
                        <span>üì∑</span>
                        <input type="file" id="imageInput" accept="image/*" style="display: none;">
                    </label>
                    <button class="add-btn" onclick="addTask()">Th√™m B√†i</button>
                </div>
            </section>

            <section class="dashboard-grid" id="stats-section">
                <div class="stat-card">
                    <span class="stat-value" id="stat-total">0</span>
                    <span class="stat-label">T·ªïng b√†i</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-done" style="color: var(--success);">0</span>
                    <span class="stat-label">Ho√†n th√†nh</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-percent" style="color: var(--accent);">0%</span>
                    <span class="stat-label">Ti·∫øn ƒë·ªô</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="main-progress"></div>
                </div>
            </section>

            <section class="search-container">
                <input type="text" id="searchInput" class="search-input"
                    placeholder="üîç T√¨m ki·∫øm b√†i t·∫≠p ho·∫∑c m√¥n h·ªçc..." oninput="renderTasks()">
            </section>

            <section id="taskList" class="list-container">
                <!-- B√†i t·∫≠p s·∫Ω hi·ªán ·ªü ƒë√¢y -->
            </section>

            <div id="empty-state" style="display: none;">
                B·∫°n ch∆∞a c√≥ b√†i t·∫≠p n√†o. H√£y th√™m m·ªôt b√†i ·ªü tr√™n nh√©!
            </div>
        </div>

        <!-- Stats Tab VIP -->
        <div id="stats-tab" class="tab-content">
            <section class="chart-section" style="padding-top: 1rem;">
                <h2
                    style="text-align: center; margin-bottom: 2rem; font-size: 1.8rem; background: linear-gradient(to right, #fff, var(--accent)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                    üìä Ph√¢n T√≠ch NƒÉng Su·∫•t</h2>

                <div class="stats-grid-vip">
                    <div class="chart-card">
                        <h3>T·ªâ l·ªá Ho√†n th√†nh</h3>
                        <div style="height: 250px;"><canvas id="completionChart"></canvas></div>
                    </div>
                    <div class="chart-card">
                        <h3>M√¥n h·ªçc ti√™u bi·ªÉu</h3>
                        <div style="height: 250px;"><canvas id="subjectChart"></canvas></div>
                    </div>
                </div>

                <div class="productivity-summary" id="productivitySummary" style="margin-top: 2rem;">
                    ƒêang t√≠nh to√°n d·ªØ li·ªáu c·ªßa b·∫°n...
                </div>
            </section>
        </div>

        <div id="guide-tab" class="tab-content">
            <section class="guide-card">
                <h2 style="text-align: center; margin-bottom: 2rem; font-size: 2rem;">üìñ H∆∞·ªõng D·∫´n S·ª≠ D·ª•ng VIP</h2>

                <div class="guide-item">
                    <h3>‚ö° Th√™m B√†i T·∫≠p Nhanh</h3>
                    <p>Nh·∫≠p t√™n b√†i t·∫≠p, m√¥n h·ªçc v√† ch·ªçn ng√†y h·∫°n. B·∫°n c√≥ th·ªÉ th√™m n·ªôi dung chi ti·∫øt ho·∫∑c ƒë√≠nh k√®m ·∫£nh
                        b·∫±ng c√°ch b·∫•m v√†o bi·ªÉu t∆∞·ª£ng üì∑.</p>
                </div>

                <div class="guide-item">
                    <h3>‚≠ê Ch·∫ø ƒê·ªô ∆Øu Ti√™n (Star)</h3>
                    <p>B·∫•m v√†o bi·ªÉu t∆∞·ª£ng ng√¥i sao ƒë·ªÉ ƒë∆∞a b√†i t·∫≠p ƒë√≥ l√™n v·ªã tr√≠ ƒë·∫ßu ti√™n. Nh·ªØng b√†i ƒë∆∞·ª£c g·∫Øn sao s·∫Ω c√≥
                        hi·ªáu ·ª©ng t·ªèa s√°ng ƒë·∫∑c bi·ªát ƒë·ªÉ b·∫°n kh√¥ng bao gi·ªù b·ªè l·ª°.</p>
                </div>

                <div class="guide-item">
                    <h3>üìä Theo D√µi Ti·∫øn ƒê·ªô</h3>
                    <div class="guide-grid">
                        <div class="guide-step">
                            <strong>T·ªïng b√†i:</strong> ƒê·∫øm t·∫•t c·∫£ nhi·ªám v·ª• b·∫°n ƒë√£ t·∫°o.
                        </div>
                        <div class="guide-step">
                            <strong>Ho√†n th√†nh:</strong> S·ªë nhi·ªám v·ª• ƒë√£ ƒë∆∞·ª£c ƒë√°nh d·∫•u xong.
                        </div>
                        <div class="guide-step">
                            <strong>Ti·∫øn ƒë·ªô:</strong> Thanh ph·∫ßn trƒÉm t·ª± ƒë·ªông c·∫≠p nh·∫≠t t√¢m tr·∫°ng h·ªçc t·∫≠p c·ªßa b·∫°n.
                        </div>
                    </div>
                </div>

                <div class="guide-item">
                    <h3>üîç T√¨m Ki·∫øm Th√¥ng Minh</h3>
                    <p>S·ª≠ d·ª•ng thanh t√¨m ki·∫øm ƒë·ªÉ l·ªçc b√†i t·∫≠p theo T√™n ho·∫∑c M√¥n h·ªçc ngay l·∫≠p t·ª©c. Danh s√°ch s·∫Ω t·ª± ƒë·ªông
                        thu nh·ªè theo √Ω b·∫°n mu·ªën.</p>
                </div>

                <div class="guide-item" style="border-bottom: none;">
                    <h3>üñ±Ô∏è T∆∞∆°ng T√°c VIP</h3>
                    <ul>
                        <li><strong>Click v√†o b√†i t·∫≠p:</strong> M·ªü c·ª≠a s·ªï Focus xem chi ti·∫øt n·ªôi dung v√† ·∫£nh l·ªõn.</li>
                        <li><strong>Ph√°o hoa:</strong> B·∫Øn tung t√≥e m·ªói khi b·∫°n ho√†n th√†nh m·ªôt b√†i t·∫≠p!</li>
                        <li><strong>√Çm thanh:</strong> T∆∞∆°ng t√°c s·ªëng ƒë·ªông v·ªõi ph·∫£n h·ªìi √¢m thanh cao c·∫•p.</li>
                    </ul>
                </div>

                <div class="guide-item"
                    style="border-top: 1px solid var(--glass-border); padding-top: 1.5rem; margin-top: 1rem;">
                    <h3>üìû Li√™n H·ªá H·ªó Tr·ª£ Admin</h3>
                    <div class="social-links" style="justify-content: flex-start; gap: 1rem;">
                        <a href="https://zalo.me/0979164184" target="_blank" class="social-item">
                            <span>üí¨ Zalo: 0979164184</span>
                        </a>
                        <a href="https://www.facebook.com/vq2007107/" target="_blank" class="social-item">
                            <span>üîµ Facebook Admin</span>
                        </a>
                    </div>
                </div>
            </section>
            <!-- Adding Theme Selector and Backup to the end of Guide or separate footer -->
            <section class="guide-card" style="margin-top: 2rem; text-align: center;">
                <h3>üé® T√πy Ch·ªânh Giao Di·ªán VIP</h3>
                <div class="theme-selector">
                    <div class="theme-dot" style="background: #6366f1;" onclick="setTheme('default')"
                        title="Indigo Neon"></div>
                    <div class="theme-dot" style="background: #ec4899;" onclick="setTheme('rose')" title="Rose Gold">
                    </div>
                    <div class="theme-dot" style="background: #10b981;" onclick="setTheme('emerald')"
                        title="Emerald Green"></div>
                    <div class="theme-dot" style="background: #f59e0b;" onclick="setTheme('amber')" title="Royal Gold">
                    </div>
                </div>

                <div class="backup-tools"
                    style="margin-top: 2rem; border-top: 1px solid var(--glass-border); padding-top: 1.5rem;">
                    <button class="btn-link" onclick="exportData()">üíæ Sao l∆∞u d·ªØ li·ªáu (Export)</button>
                    <button class="btn-link" onclick="document.getElementById('importFile').click()">üìÇ Kh√¥i ph·ª•c d·ªØ
                        li·ªáu (Import)</button>
                    <input type="file" id="importFile" style="display: none;" onchange="importData(event)">
                </div>
            </section>

        </div>

        <div id="admin-tab" class="tab-content">
            <section class="guide-card">
                <h2 style="text-align: center; margin-bottom: 2rem; font-size: 2rem;">‚öôÔ∏è H·ªá Th·ªëng Qu·∫£n Tr·ªã T·ªëi Cao</h2>
                <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem;">
                    Ch√†o Admin <strong>Nguy·ªÖn VƒÉn Qu√¢n</strong>, b√™n d∆∞·ªõi l√† danh s√°ch to√†n b·ªô ng∆∞·ªùi d√πng trong h·ªá
                    th·ªëng.
                </p>
                <div style="overflow-x: auto;">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Ng∆∞·ªùi d√πng</th>
                                <th>M·∫≠t kh·∫©u</th> <!-- Added Password Column -->
                                <th>Email</th>
                                <th>Quy·ªÅn h·∫°n</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="userListBody"></tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Global Global Footer (Visible in all tabs) -->
        <footer class="admin-contact-footer" style="margin: 3rem auto 2rem auto;">
            <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">¬© 2026 Designed by Nguy·ªÖn
                VƒÉn Qu√¢n</p>
            <div class="social-links">
                <a href="https://zalo.me/0979164184" target="_blank" class="social-item">
                    <span>Zalo: 0979164184</span>
                </a>
                <a href="https://www.facebook.com/vq2007107/" target="_blank" class="social-item">
                    <span>Facebook Admin</span>
                </a>
            </div>
        </footer>
    </div>
    <!-- Modal Xem Chi Ti·∫øt -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCXYKwDn5awzJE1y443GB7NnoaJoq-aip4",
            authDomain: "myhomeworkmanager-a3c45.firebaseapp.com",
            projectId: "myhomeworkmanager-a3c45",
            storageBucket: "myhomeworkmanager-a3c45.firebasestorage.app",
            messagingSenderId: "947176303934",
            appId: "1:947176303934:web:5d62b4f00700c85813506f",
            measurementId: "G-EW8NRVPTGF"
        };
        // Initialize Firebase safely
        let db;
        try {
            if (typeof firebase !== 'undefined') {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
            } else {
                console.warn("Firebase SDK not loaded. Working in Offline Mode.");
            }
        } catch (e) {
            console.error("Firebase Auth/Init Error:", e);
        }

        // Authentication Logic
        let users = [];
        try {
            users = JSON.parse(localStorage.getItem('hw_users')) || [];
        } catch (e) {
            console.error("Error parsing users:", e);
            users = [];
        }

        // Seed Admin Account if not exists
        if (!users.find(u => u.username === 'admin')) {
            users.push({
                username: 'admin',
                password: 'admin123',
                email: 'admin@viquan.vip',
                role: 'admin'
            });
            localStorage.setItem('hw_users', JSON.stringify(users));
        }

        let currentUser = sessionStorage.getItem('current_user');
        let recoveryUser = null; // To track user being reset
        let recoveryMode = false; // Is the OTP for login or reset?

        // H·ªá th·ªëng m thanh UI (S·ª≠a l·ªói ReferenceError: playSound is not defined)
        function playSound(type) {
            try {
                const sounds = {
                    'click': 'https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3',
                    'success': 'https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3',
                    'delete': 'https://assets.mixkit.co/active_storage/sfx/2617/2617-preview.mp3'
                };
                if (sounds[type]) {
                    const audio = new Audio(sounds[type]);
                    audio.volume = 0.3;
                    audio.play().catch(() => { /* √Åt ch·∫ø l·ªói Autoplay */ });
                }
            } catch (e) { console.warn("L·ªói ph√°t √¢m thanh UI:", e); }
        }

        // Music Playlist Logic (S·ª≠ d·ª•ng ngu·ªìn c·ª±c k·ª≥ ·ªïn ƒë·ªãnh t·ª´ Pixabay/SoundHelix)
        const musicPlaylist = [
            { name: "Coffee Time Lofi", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
            { name: "Focus & Chill", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
            { name: "Midnight Study", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" },
            { name: "Dreamy Vibes", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" }
        ];
        let currentTrackIndex = parseInt(localStorage.getItem('current_track_index')) || 0;
        let isMusicPlaying = localStorage.getItem('music_enabled') === 'true';

        const bgMusic = document.getElementById('bgMusic');
        const musicToggle = document.getElementById('musicToggle');
        const musicIcon = document.getElementById('musicIcon');
        const musicTitle = document.getElementById('musicTitle');
        const musicPlayer = document.getElementById('musicPlayer');

        function loadTrack(index) {
            try {
                const track = musicPlaylist[index];
                if (!track) return;
                bgMusic.pause();
                bgMusic.src = track.url;
                bgMusic.load(); // Bu·ªôc tr√¨nh duy·ªát t·∫£i l·∫°i ngu·ªìn m·ªõi
                musicTitle.textContent = track.name;
                localStorage.setItem('current_track_index', index);
                console.log(`[Music] ƒê√£ t·∫£i b√†i: ${track.name}`);
            } catch (e) {
                console.error("[Music] L·ªói loadTrack:", e);
            }
        }

        function toggleMusic() {
            if (isMusicPlaying) {
                bgMusic.pause();
                musicIcon.textContent = 'üîá';
                musicToggle.classList.remove('playing');
                musicPlayer.classList.remove('playing');
                isMusicPlaying = false;
            } else {
                audioRetryCount = 0;
                if (!bgMusic.src || bgMusic.src === "" || bgMusic.src.includes('undefined')) {
                    loadTrack(currentTrackIndex);
                }

                // Chi·∫øn thu·∫≠t ph√°t nh·∫°c linh ho·∫°t
                const playPromise = bgMusic.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log("[Music] ƒêang ph√°t nh·∫°c m∆∞·ª£t m√†...");
                    }).catch(error => {
                        console.warn("[Music] Tr√¨nh duy·ªát ch·∫∑n t·ª± ƒë·ªông ph√°t. H√£y click v√†o trang ƒë·ªÉ nghe nh·∫°c.", error);
                        // ƒê·ª£i ng∆∞·ªùi d√πng click v√†o b·∫•t c·ª© ƒë√¢u ƒë·ªÉ th·ª≠ l·∫°i
                        const retryOnActive = () => {
                            bgMusic.play();
                            window.removeEventListener('mousedown', retryOnActive);
                        };
                        window.addEventListener('mousedown', retryOnActive);
                    });
                }

                musicIcon.textContent = 'üéµ';
                musicToggle.classList.add('playing');
                musicPlayer.classList.add('playing');
                isMusicPlaying = true;
            }
            localStorage.setItem('music_enabled', isMusicPlaying);
            playSound('click');
        }

        function nextMusic() {
            audioRetryCount = 0; // Reset khi chuy·ªÉn b√†i th·ªß c√¥ng
            currentTrackIndex = (currentTrackIndex + 1) % musicPlaylist.length;
            loadTrack(currentTrackIndex);
            if (isMusicPlaying) bgMusic.play();
            playSound('click');
        }

        function prevMusic() {
            audioRetryCount = 0; // Reset khi chuy·ªÉn b√†i th·ªß c√¥ng
            currentTrackIndex = (currentTrackIndex - 1 + musicPlaylist.length) % musicPlaylist.length;
            loadTrack(currentTrackIndex);
            if (isMusicPlaying) bgMusic.play();
            playSound('click');
        }

        function handleMusicPlay() {
            musicIcon.textContent = 'üéµ';
            musicToggle.classList.add('playing');
            musicPlayer.classList.add('playing');
            isMusicPlaying = true;
        }

        let audioRetryCount = 0;
        function handleAudioError() {
            try {
                audioRetryCount++;
                const error = bgMusic.error;
                let errorMsg = "L·ªói m·∫°ng ho·∫∑c Link kh√¥ng kh·∫£ d·ª•ng";

                if (error) {
                    if (error.code === 1) errorMsg = "T·∫£i nh·∫°c b·ªã h·ªßy";
                    else if (error.code === 2) errorMsg = "S·ª± c·ªë m·∫°ng";
                    else if (error.code === 3) errorMsg = "L·ªói gi·∫£i m√£ √¢m thanh";
                    else if (error.code === 4) errorMsg = "ƒê·ªãnh d·∫°ng nh·∫°c kh√¥ng h·ªó tr·ª£";
                }

                console.warn(`[Music] L·ªói: ${errorMsg} (${audioRetryCount}/${musicPlaylist.length}). ƒêang th·ª≠ b√†i ti·∫øp theo...`);

                if (audioRetryCount >= musicPlaylist.length) {
                    console.error("[Music] T·∫•t c·∫£ b√†i h√°t ƒë·ªÅu l·ªói. H·ªá th·ªëng nh·∫°c s·∫Ω t·∫°m ngh·ªâ.");
                    isMusicPlaying = false;
                    musicIcon.textContent = 'üîá';
                    musicToggle.classList.remove('playing');
                    musicPlayer.classList.remove('playing');
                    localStorage.setItem('music_enabled', 'false');
                    audioRetryCount = 0;
                    return;
                }

                setTimeout(nextMusic, 500); // ƒê·ª£i 0.5s tr∆∞·ªõc khi th·ª≠ b√†i m·ªõi
            } catch (e) { console.error("Audio error handler failed:", e); }
        }

        // H√†m kh·ªüi t·∫°o √¢m nh·∫°c (s·∫Ω ƒë∆∞·ª£c g·ªçi trong masterInit)
        function initMusic() {
            try {
                audioRetryCount = 0; // Reset retry count
                loadTrack(currentTrackIndex);

                if (isMusicPlaying) {
                    musicIcon.textContent = 'üéµ';
                    musicToggle.classList.add('playing');
                    musicPlayer.classList.add('playing');
                }

                // T·ª± ƒë·ªông ph√°t n·∫øu ƒë√£ b·∫≠t tr∆∞·ªõc ƒë√≥ (c·∫ßn t∆∞∆°ng t√°c ng∆∞·ªùi d√πng)
                const autoPlayHandler = () => {
                    if (isMusicPlaying && bgMusic.paused) {
                        bgMusic.play().then(() => {
                            console.log("‚úÖ T·ª± ƒë·ªông ph√°t nh·∫°c th√†nh c√¥ng");
                        }).catch(e => {
                            console.warn("‚ö†Ô∏è Kh√¥ng th·ªÉ t·ª± ƒë·ªông ph√°t, c·∫ßn t∆∞∆°ng t√°c m·∫°nh h∆°n t·ª´ ng∆∞·ªùi d√πng:", e);
                        });
                    }
                    window.removeEventListener('click', autoPlayHandler);
                };
                window.addEventListener('click', autoPlayHandler);
                console.log("‚úÖ √Çm nh·∫°c ƒë√£ s·∫µn s√†ng");
            } catch (e) { console.error("L·ªói kh·ªüi t·∫°o √¢m nh·∫°c:", e); }
        }

        function togglePassword(inputId, icon) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'üôà';
            } else {
                input.type = 'password';
                icon.textContent = 'üëÅÔ∏è';
            }
            playSound('click');
        }

        function toggleAuth(mode) {
            playSound('click');
            const forms = ['loginForm', 'registerForm', 'forgotForm', 'resetForm', 'verifyForm'];
            forms.forEach(f => document.getElementById(f).style.display = 'none');

            if (mode === 'register') document.getElementById('registerForm').style.display = 'block';
            else if (mode === 'forgot') document.getElementById('forgotForm').style.display = 'block';
            else if (mode === 'reset') document.getElementById('resetForm').style.display = 'block';
            else if (mode === 'login') document.getElementById('loginForm').style.display = 'block';
        }

        async function handleRegister() {
            const user = document.getElementById('regUser').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const pass = document.getElementById('regPass').value.trim();
            const confirmPass = document.getElementById('regConfirmPass').value.trim();

            if (!user || !email || !pass || !confirmPass) return alert("Vui l√≤ng nh·∫≠p ƒë·ªß c√°c tr∆∞·ªùng th√¥ng tin!");
            if (pass !== confirmPass) return alert("‚ùå M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng tr√πng kh·ªõp!");
            if (users.find(u => u.username === user)) return alert("T√™n t√†i kho·∫£n n√†y ƒë√£ c√≥ ng∆∞·ªùi d√πng!");

            const newUser = {
                username: user,
                password: pass,
                email: email,
                role: 'user',
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            localStorage.setItem('hw_users', JSON.stringify(users));

            // Cloud Sync for User Profiles
            if (typeof db !== 'undefined') {
                try {
                    await db.collection('users_profiles').doc(user).set(newUser);
                    console.log("‚òÅÔ∏è User Account Synced to Cloud:", user);
                } catch (e) {
                    console.error("‚ùå Cloud Register Error:", e);
                }
            }

            playSound('success');
            showOTPModal("‚ú® ƒêƒÉng k√Ω th√†nh c√¥ng! H√£y d√πng t√†i kho·∫£n n√†y ƒë·ªÉ ƒëƒÉng nh·∫≠p.", "üéâ Ch√∫c M·ª´ng");
            toggleAuth('login');
        }

        let currentOTP = "";
        let pendingUser = null;

        function handleForgotPassword() {
            const email = document.getElementById('forgotEmail').value.trim();
            const user = users.find(u => u.email === email);

            if (!user) return showOTPModal("‚ùå Email n√†y ch∆∞a ƒë∆∞·ª£c ƒëƒÉng k√Ω trong h·ªá th·ªëng!", "‚ö†Ô∏è L·ªói");

            playSound('success');
            recoveryUser = user.username;
            recoveryMode = true;
            currentOTP = Math.floor(100000 + Math.random() * 900000).toString();

            document.getElementById('forgotForm').style.display = 'none';
            document.getElementById('verifyForm').style.display = 'block';
            document.getElementById('verifyMsg').innerHTML = `M√£ kh√¥i ph·ª•c ƒë√£ ƒë∆∞·ª£c g·ª≠i t·ªõi:<br><strong style="color:var(--accent)">${email}</strong><br>(M√£ demo: <span style="cursor:pointer" onclick="showOTPModal('M√£ x√°c th·ª±c c·ªßa b·∫°n l√†: <strong style=\\'font-size: 1.5rem; color: var(--accent); display: block; margin-top: 10px;\\'>' + currentOTP + '</strong>')">${currentOTP}</span>)`;

            // Auto show modal for Forgot Password
            showOTPModal(`M√£ kh√¥i ph·ª•c <strong>${currentOTP}</strong> ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email <strong>${email}</strong>.<br>Vui l√≤ng ki·ªÉm tra v√† nh·∫≠p m√£ ƒë·ªÉ ti·∫øp t·ª•c.`);
        }

        function handleResetPassword() {
            const pass = document.getElementById('newPass').value;
            const confirm = document.getElementById('confirmNewPass').value;

            if (!pass || pass !== confirm) return showOTPModal("‚ùå M·∫≠t kh·∫©u m·ªõi kh√¥ng tr√πng kh·ªõp ho·∫∑c tr·ªëng!", "‚ö†Ô∏è L·ªói");

            users = users.map(u => u.username === recoveryUser ? {
                ...u,
                password: pass
            } : u);
            localStorage.setItem('hw_users', JSON.stringify(users));
            playSound('success');
            showOTPModal("‚úÖ ƒê√£ c·∫≠p nh·∫≠t m·∫≠t kh·∫©u m·ªõi! B·∫°n c√≥ th·ªÉ ƒëƒÉng nh·∫≠p ngay.", "üéâ Th√†nh C√¥ng");
            toggleAuth('login');
        }

        function handleLogin() {
            const user = document.getElementById('loginUser').value.trim();
            const pass = document.getElementById('loginPass').value.trim();

            const found = users.find(u => u.username === user && u.password === pass);
            if (found) {
                // B∆∞·ªõc x√°c th·ª±c 2 l·ªõp gi·∫£ l·∫≠p
                playSound('success');
                pendingUser = user;
                recoveryMode = false;
                currentOTP = Math.floor(100000 + Math.random() * 900000).toString();

                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('verifyForm').style.display = 'block';
                document.getElementById('verifyMsg').innerHTML = `M√£ b·∫£o m·∫≠t ƒë√£ ƒë∆∞·ª£c g·ª≠i t·ªõi:<br><strong style="color:var(--accent)">${found.email}</strong><br>(M√£ demo: <span style="cursor:pointer" onclick="showOTPModal('M√£ x√°c th·ª±c c·ªßa b·∫°n l√†: <strong style=\\'font-size: 1.5rem; color: var(--accent); display: block; margin-top: 10px;\\'>' + currentOTP + '</strong>')">${currentOTP}</span>)`;

                // Cloud Sync for existing users who might only be local
                if (typeof db !== 'undefined') {
                    db.collection('users_profiles').doc(user).set(found).catch(e => console.error("Sync on Login error", e));
                }

                showOTPModal(`M√£ x√°c th·ª±c <strong>${currentOTP}</strong> ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email <strong>${found.email}</strong>.<br>Vui l√≤ng ki·ªÉm tra v√† nh·∫≠p m√£ ƒë·ªÉ ti·∫øp t·ª•c.`);
            } else {
                showOTPModal("‚ùå Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!", "‚ö†Ô∏è ƒêƒÉng Nh·∫≠p Th·∫•t B·∫°i");
            }
        }

        function confirmOTP() {
            const input = document.getElementById('otpInput').value.trim();
            if (input === currentOTP) {
                playSound('success');
                document.getElementById('otpInput').value = "";

                if (recoveryMode) {
                    document.getElementById('verifyForm').style.display = 'none';
                    document.getElementById('resetForm').style.display = 'block';
                } else {
                    sessionStorage.setItem('current_user', pendingUser);
                    currentUser = pendingUser;

                    // Reload users from localStorage to get fresh data
                    try {
                        const savedUsers = localStorage.getItem('hw_users');
                        if (savedUsers) users = JSON.parse(savedUsers);
                    } catch (e) { console.error("Reload users error", e); }

                    initApp();
                    // Reset form x√°c th·ª±c
                    document.getElementById('verifyForm').style.display = 'none';
                }
            } else {
                showOTPModal("‚ùå M√£ x√°c th·ª±c kh√¥ng ch√≠nh x√°c. Vui l√≤ng ki·ªÉm tra l·∫°i!", "‚ö†Ô∏è L·ªói");
            }
        }

        function handleLogout() {
            playSound('delete');
            sessionStorage.removeItem('current_user');
            location.reload();
        }

        async function initApp() {
            if (!currentUser) {
                document.getElementById('authPortal').style.display = 'flex';
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('verifyForm').style.display = 'none';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('userHeader').style.display = 'none';
            } else {
                document.getElementById('authPortal').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('userHeader').style.display = 'flex';

                // Request Notification Permission (Safety Check)
                if (typeof Notification !== 'undefined') {
                    if (Notification.permission !== "granted" && Notification.permission !== "denied") {
                        Notification.requestPermission();
                    }
                }

                // Load User Profile (Refresh Data & Show)
                try {
                    const savedUsers = localStorage.getItem('hw_users');
                    if (savedUsers) users = JSON.parse(savedUsers);
                } catch (e) { console.error("Reload users error", e); }
                updateProfileDisplay();

                // 1. Hi·ªán d·ªØ li·ªáu c·ª•c b·ªô ngay l·∫≠p t·ª©c (Instant Render)
                renderTasks();

                // 2. Ch·∫°y ng·∫ßm vi·ªác t·∫£i d·ªØ li·ªáu t·ª´ Cloud
                if (typeof db !== 'undefined') {
                    try {
                        const doc = await db.collection('user_tasks').doc(currentUser).get();
                        if (doc.exists) {
                            const cloudTasks = doc.data().tasks || [];
                            // Ch·ªâ c·∫≠p nh·∫≠t n·∫øu d·ªØ li·ªáu ƒë√°m m√¢y kh√°c v·ªõi d·ªØ li·ªáu hi·ªán t·∫°i (ho·∫∑c lu√¥n c·∫≠p nh·∫≠t ƒë·ªÉ ƒë·ªìng b·ªô)
                            tasks = cloudTasks;
                            localStorage.setItem('hw_tasks', JSON.stringify(tasks));
                            renderTasks(); // V·∫Ω l·∫°i giao di·ªán v·ªõi d·ªØ li·ªáu m·ªõi t·ª´ m√¢y
                            console.log("Cloud Data Synced for:", currentUser);
                        }
                        // Admin specific logic
                        const userObj = users.find(u => u.username === currentUser);
                        if (userObj && userObj.role === 'admin') {
                            document.getElementById('adminTabBtn').style.display = 'block';

                            // Fetch Global User List if Admin
                            if (typeof db !== 'undefined') {
                                try {
                                    const snapshot = await db.collection('users_profiles').get();
                                    const globalUsers = [];
                                    snapshot.forEach(doc => globalUsers.push(doc.data()));

                                    if (globalUsers.length > 0) {
                                        // Merge global users into local users for current session
                                        globalUsers.forEach(gu => {
                                            if (!users.find(u => u.username === gu.username)) {
                                                users.push(gu);
                                            }
                                        });
                                        // Preserve local edits but prioritize cloud list
                                        localStorage.setItem('hw_users', JSON.stringify(users));
                                    }
                                    renderUsers();
                                } catch (e) {
                                    console.error("‚ùå Admin Cloud Fetch Error:", e);
                                    renderUsers();
                                }
                            } else {
                                renderUsers();
                            }
                        } else {
                            document.getElementById('adminTabBtn').style.display = 'none';
                        }

                    } catch (e) {
                        console.error("Cloud Load Error:", e);
                    }
                }
            }
        }

        function renderUsers() {
            const tbody = document.getElementById('userListBody');
            tbody.innerHTML = users.map(u => `
                <tr>
                    <td><strong>${u.username}</strong></td>
                    <td style="font-family: monospace; letter-spacing: 1px;">${u.password}</td> <!-- Render Password -->
                    <td>${u.email}</td>
                    <td><span class="role-badge ${u.role === 'admin' ? 'role-admin' : 'role-user'}">${u.role === 'admin' ? 'ADMIN' : 'USER'}</span></td>
                    <td>
                        ${u.role !== 'admin' ? `<button class="btn-delete-user" onclick="deleteUser('${u.username}')">X√≥a</button>` : '---'}
                    </td>
                </tr>
            `).join('');
        }

        async function deleteUser(username) {
            if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a vƒ©nh vi·ªÖn t√†i kho·∫£n "${username}" kh√¥ng?`)) {
                playSound('delete');

                // 1. Delete from Cloud
                if (typeof db !== 'undefined') {
                    try {
                        await db.collection('users_profiles').doc(username).delete();
                        console.log("‚òÅÔ∏è User deleted from Cloud:", username);
                    } catch (e) {
                        console.error("‚ùå Cloud Delete User Error:", e);
                    }
                }

                // 2. Delete from Local
                users = users.filter(u => u.username !== username);
                localStorage.setItem('hw_users', JSON.stringify(users));
                renderUsers();
                alert(`‚úÖ ƒê√£ x√≥a t√†i kho·∫£n "${username}" th√†nh c√¥ng tr√™n to√†n h·ªá th·ªëng.`);
            }
        }

        // Legendary Tools Logic
        let pomoMinutes = 25;
        let pomoSeconds = 0;
        let isPomoRunning = false;
        let basePomoMinutes = 25;
        let pomoInterval;

        function setPomoDuration(mins, btn) {
            playSound('click');
            const newMins = parseInt(mins);
            if (isNaN(newMins) || newMins <= 0) {
                // alert("Vui l√≤ng nh·∫≠p s·ªë ph√∫t h·ª£p l·ªá cho Pomodoro."); // Removed alert for better UX on input
                return;
            }
            basePomoMinutes = newMins;
            resetPomo();

            document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
            if (btn) {
                btn.classList.add('active');
                document.getElementById('customPomo').value = ''; // Clear custom input if a preset is clicked
            } else {
                // If custom input was used, ensure no preset button is active
                // and potentially highlight the custom input or indicate it's active
            }
        }

        function togglePomo() {
            playSound('click');
            if (isPomoRunning) {
                clearInterval(pomoInterval);
                document.getElementById('pomoStartBtn').textContent = "TI·∫æP T·ª§C";
                document.body.classList.remove('deep-work-active'); // Pause Deep Work
            } else {
                pomoInterval = setInterval(updatePomo, 1000);
                document.getElementById('pomoStartBtn').textContent = "T·∫†M D·ª™NG";
                document.body.classList.add('deep-work-active'); // Enable Deep Work

                // Show notification hint
                if (!window.hasShownDeepWorkHint) {
                    showOTPModal("üåô Ch·∫ø ƒë·ªô <strong>Deep Work</strong> ƒë√£ ƒë∆∞·ª£c k√≠ch ho·∫°t.<br>M·ªçi th·ª© xao nh√£ng s·∫Ω b·ªã ·∫©n ƒëi ƒë·ªÉ b·∫°n t·∫≠p trung tuy·ªát ƒë·ªëi.", "üõ°Ô∏è T·∫≠p Trung Cao ƒê·ªô");
                    window.hasShownDeepWorkHint = true;
                }
            }
            isPomoRunning = !isPomoRunning;
        }

        function resetPomo() {
            playSound('click');
            clearInterval(pomoInterval);
            isPomoRunning = false;
            pomoMinutes = basePomoMinutes;
            pomoSeconds = 0;
            const m = String(pomoMinutes).padStart(2, '0');
            document.getElementById('pomoDisplay').textContent = `${m}:00`;
            document.getElementById('pomoStartBtn').textContent = "B·∫ÆT ƒê·∫¶U";
            document.body.classList.remove('deep-work-active'); // Disable Deep Work
        }

        function updatePomo() {
            if (pomoSeconds === 0) {
                if (pomoMinutes === 0) {
                    clearInterval(pomoInterval);
                    playSound('success');

                    // Browser Notification VIP
                    if (Notification.permission === "granted") {
                        new Notification("üïí H·∫øt gi·ªù r·ªìi!", {
                            body: "B·∫°n ƒë√£ ho√†n th√†nh phi√™n t·∫≠p trung. H√£y ngh·ªâ ng∆°i m·ªôt ch√∫t nh√©!",
                            icon: "https://viquan.vip/favicon.ico" // Placeholder if no favicon
                        });
                    } else {
                        alert("üïí H·∫øt th·ªùi gian t·∫≠p trung! H√£y ngh·ªâ ng∆°i m·ªôt l√°t.");
                    }

                    resetPomo();
                    return;
                }
                pomoMinutes--;
                pomoSeconds = 59;
            } else {
                pomoSeconds--;
            }
            const m = String(pomoMinutes).padStart(2, '0');
            const s = String(pomoSeconds).padStart(2, '0');
            document.getElementById('pomoDisplay').textContent = `${m}:${s}`;
        }

        function setTheme(theme, silent = false) {
            if (!silent) playSound('click');
            document.body.className = theme === 'default' ? '' : `theme-${theme}`;
            localStorage.setItem('hw_theme', theme);
        }

        function exportData() {
            playSound('click');
            const blob = new Blob([JSON.stringify(tasks)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `VanQuan_Homework_Backup_${new Date().toLocaleDateString()}.json`;
            a.click();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                tasks = JSON.parse(e.target.result);
                saveAndRender();
                playSound('success');
                alert("üìÇ ƒê√£ kh√¥i ph·ª•c d·ªØ li·ªáu th√†nh c√¥ng!");
            };
            reader.readAsText(file);
        }

        // √Çm thanh VIP
        const sounds = {
            click: new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3'),
            success: new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3'),
            delete: new Audio('https://assets.mixkit.co/active_storage/sfx/2619/2619-preview.mp3')
        };
        sounds.click.volume = 0.3;
        sounds.success.volume = 0.4;
        sounds.delete.volume = 0.3;

        function playSound(type) {
            sounds[type].currentTime = 0;
            sounds[type].play().catch(() => { });
        }
        let tasks = [];
        try {
            tasks = JSON.parse(localStorage.getItem('hw_tasks')) || [];
        } catch (e) {
            console.error("Error parsing tasks:", e);
            tasks = [];
        }

        async function saveAndRender() {
            localStorage.setItem('hw_tasks', JSON.stringify(tasks));
            renderTasks();

            // Cloud Sync
            if (currentUser && typeof db !== 'undefined') {
                try {
                    await db.collection('user_tasks').doc(currentUser).set({
                        tasks: tasks,
                        lastSync: new Date().toISOString()
                    });
                    console.log("Cloud Sync Success");
                } catch (e) {
                    console.error("Cloud Sync Error:", e);
                }
            }
        }

        function addTask() {
            playSound('click');
            const name = document.getElementById('taskName').value;
            const subject = document.getElementById('subject').value || "Ch∆∞a ph√¢n lo·∫°i";
            const date = document.getElementById('dueDate').value || "Kh√¥ng c√≥ h·∫°n";
            const time = document.getElementById('dueTime').value || ""; // Get time value
            const content = document.getElementById('taskContent').value;
            const imageInput = document.getElementById('imageInput');
            const imageFile = imageInput.files[0];

            if (!name) return alert("Vui l√≤ng nh·∫≠p t√™n b√†i t·∫≠p!");

            const proceedWithTask = (base64Img = null) => {
                const newTask = {
                    id: Date.now(),
                    name: name,
                    subject: subject,
                    date: date,
                    time: time, // Add time to the task object
                    content: content,
                    completed: false,
                    starred: false,
                    image: base64Img
                };

                tasks.unshift(newTask);
                document.getElementById('taskName').value = "";
                document.getElementById('subject').value = "";
                document.getElementById('dueDate').value = "";
                document.getElementById('dueTime').value = ""; // Clear time input
                document.getElementById('taskContent').value = "";
                imageInput.value = ""; // Reset file input

                saveAndRender();
            };

            if (imageFile) {
                const reader = new FileReader();
                reader.onload = (e) => proceedWithTask(e.target.result);
                reader.readAsDataURL(imageFile);
            } else {
                proceedWithTask();
            }
        }

        function toggleTask(id) {
            tasks = tasks.map(task => {
                if (task.id === id) {
                    const willComplete = !task.completed;
                    if (willComplete) {
                        playSound('success');
                        // Hi·ªáu ·ª©ng ph√°o hoa Elite (Safety Check)
                        if (typeof confetti === 'function') {
                            confetti({
                                particleCount: 150,
                                spread: 70,
                                origin: { y: 0.6 },
                                colors: ['#6366f1', '#ec4899', '#ffffff']
                            });
                        }
                    }
                    return { ...task, completed: willComplete };
                }
                return task;
            });
            saveAndRender();
        }

        function toggleStar(id) {
            tasks = tasks.map(task =>
                task.id === id ? { ...task, starred: !task.starred } : task
            );
            saveAndRender();
        }

        function deleteTask(id) {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b√†i t·∫≠p n√†y kh√¥ng?")) {
                playSound('delete');
                tasks = tasks.filter(task => task.id !== id);
                saveAndRender();
            }
        }

        function saveAndRender() {
            // 1. L∆∞u LocalStorage (∆Øu ti√™n t·ªëc ƒë·ªô)
            localStorage.setItem('hw_tasks', JSON.stringify(tasks));

            // 2. Render l·∫°i giao di·ªán
            renderTasks();

            // 3. ƒê·ªìng b·ªô l√™n Cloud (Ch·∫°y ng·∫ßm)
            if (currentUser && typeof db !== 'undefined') {
                db.collection('user_tasks').doc(currentUser).set({
                    tasks: tasks, // M·∫£ng tasks hi·ªán t·∫°i
                    last_updated: new Date().toISOString()
                }, { merge: true }) // Merge ƒë·ªÉ kh√¥ng m·∫•t c√°c field kh√°c n·∫øu c√≥
                    .then(() => {
                        console.log("‚òÅÔ∏è ƒê√£ ƒë·ªìng b·ªô d·ªØ li·ªáu l√™n Cloud cho:", currentUser);
                    })
                    .catch((error) => {
                        console.error("‚ùå L·ªói ƒë·ªìng b·ªô Cloud:", error);
                    });
            }
        }

        function renderTasks() {
            try {
                const list = document.getElementById('taskList');
                const empty = document.getElementById('empty-state');
                const searchInput = document.getElementById('searchInput');
                if (!list || !empty || !searchInput) return;

                const searchQuery = searchInput.value.toLowerCase();
                list.innerHTML = "";

                let filteredTasks = tasks.filter(task => {
                    const name = (task.name || "").toLowerCase();
                    const subject = (task.subject || "").toLowerCase();
                    return name.includes(searchQuery) || subject.includes(searchQuery);
                });

                // S·∫Øp x·∫øp: G·∫Øn sao l√™n ƒë·∫ßu, r·ªìi ƒë·∫øn b√†i m·ªõi nh·∫•t
                filteredTasks.sort((a, b) => {
                    if (a.starred === b.starred) return 0;
                    return a.starred ? -1 : 1;
                });

                if (filteredTasks.length === 0) {
                    empty.style.display = "block";
                    empty.textContent = searchQuery ? "Kh√¥ng t√¨m th·∫•y b√†i t·∫≠p n√†o kh·ªõp v·ªõi t·ª´ kh√≥a." : "B·∫°n ch∆∞a c√≥ b√†i t·∫≠p n√†o. H√£y th√™m m·ªôt b√†i ·ªü tr√™n nh√©!";
                    return;
                } else {
                    empty.style.display = "none";
                }

                filteredTasks.forEach((task, index) => {
                    const card = document.createElement('div');

                    // Logic Kh·∫©n C·∫•p
                    let urgentHtml = "";
                    const today = new Date();
                    const taskDate = new Date(task.date);
                    const diffTime = taskDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    const isUrgent = !task.completed && diffDays >= 0 && diffDays <= 1;

                    card.className = `task-card ${task.completed ? 'completed' : ''} ${task.starred ? 'starred' : ''} ${isUrgent ? 'urgent' : ''}`;
                    card.style.animationDelay = `${index * 0.1}s`;

                    if (isUrgent) {
                        urgentHtml = `<span class="badge-urgent">KH·∫®N C·∫§P</span>`;
                    }

                    const imageHtml = task.image ? `<img src="${task.image}" class="task-image-preview" onclick="window.open('${task.image}')" title="B·∫•m ƒë·ªÉ xem ·∫£nh l·ªõn">` : '';
                    const contentHtml = task.content ? `<p style="margin-top: 0.5rem; color: var(--text-dim); font-size: 0.9rem; white-space: pre-wrap;">${task.content}</p>` : '';

                    card.innerHTML = `
                        <div class="task-left" onclick="showModal(${task.id})">
                            ${imageHtml}
                            <div class="task-info">
                                <h3>${task.starred ? '‚≠ê ' : ''}${task.name} ${urgentHtml}</h3>
                                <p>M√¥n: ${task.subject} ‚Ä¢ H·∫°n: ${task.date} ${task.time ? `(${task.time})` : ''}</p>
                                ${contentHtml}
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn-action btn-star ${task.starred ? 'active' : ''}" onclick="event.stopPropagation(); toggleStar(${task.id})" title="∆Øu ti√™n">
                                ${task.starred ? '‚òÖ' : '‚òÜ'}
                            </button>
                            <button class="btn-action btn-done" onclick="event.stopPropagation(); toggleTask(${task.id})" title="Ho√†n th√†nh">
                                ‚úì
                            </button>
                            <button class="btn-action btn-delete" onclick="event.stopPropagation(); deleteTask(${task.id})" title="X√≥a">
                                ‚úï
                            </button>
                        </div>
                    `;
                    list.appendChild(card);
                });

                updateStats();
            } catch (e) {
                console.error("L·ªói RenderTasks:", e);
            }
        }

        function updateStats() {
            const total = tasks.length;
            const done = tasks.filter(t => t.completed).length;
            const percent = total === 0 ? 0 : Math.round((done / total) * 100);

            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-done').textContent = done;
            document.getElementById('stat-percent').textContent = `${percent}%`;
            document.getElementById('main-progress').style.width = `${percent}%`;
        }

        function updateLiveTime() {
            try {
                const now = new Date();

                // Update Cyber Clock Digits
                const h = String(now.getHours()).padStart(2, '0');
                const m = String(now.getMinutes()).padStart(2, '0');
                const s = String(now.getSeconds()).padStart(2, '0');

                // Update text content with safety check
                const elH = document.getElementById('clock-hours');
                const elM = document.getElementById('clock-minutes');
                const elS = document.getElementById('clock-seconds');

                if (elH) elH.textContent = h;
                if (elM) elM.textContent = m;
                if (elS) elS.textContent = s;

                // Hi·ªÉn th·ªã ng√†y (v·ªõi fallback)
                let dateStr = "";
                try {
                    dateStr = now.toLocaleDateString('vi-VN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                } catch (e) {
                    dateStr = now.toDateString();
                }
                const dateEl = document.getElementById('live-date');
                if (dateEl) dateEl.textContent = dateStr;

                // C·∫≠p nh·∫≠t l·ªùi ch√†o
                const hour = now.getHours();
                let greeting = "";
                if (hour >= 5 && hour < 12) greeting = "üåÖ Ch√†o bu·ªïi s√°ng r·∫°ng r·ª°";
                else if (hour >= 12 && hour < 18) greeting = "‚òÄÔ∏è Ch√†o bu·ªïi chi·ªÅu nƒÉng l∆∞·ª£ng";
                else if (hour >= 18 && hour < 22) greeting = "üåô Ch√†o bu·ªïi t·ªëi b√¨nh y√™n";
                else greeting = "üåå L√†m vi·ªác khuya r·ªìi, ngh·ªâ ng∆°i th√¥i";

                const greetingEl = document.getElementById('greeting-text');
                if (greetingEl) greetingEl.textContent = greeting;
            } catch (e) {
                console.error("L·ªói ƒë·ªìng h·ªì:", e);
            }
        }

        const quotes = [
            "H√†nh tr√¨nh v·∫°n d·∫∑m b·∫Øt ƒë·∫ßu t·ª´ m·ªôt b∆∞·ªõc ch√¢n.",
            "Th√†nh c√¥ng l√† k·∫øt qu·∫£ c·ªßa s·ª± chu·∫©n b·ªã m·ªói ng√†y.",
            "H√£y l√†m vi·ªác khi ng∆∞·ªùi kh√°c ƒëang ng·ªß.",
            "H√¥m nay chƒÉm ch·ªâ, mai n√†y th√™nh thang.",
            "Ki·∫øn th·ª©c l√† s·ª©c m·∫°nh, th·ª±c h√†nh l√† ch√¨a kh√≥a."
        ];

        function rotateQuote() {
            const display = document.getElementById('quote-display');
            if (!display) return;
            display.style.opacity = 0;
            setTimeout(() => {
                const randomQuote = quotes[Math.floor(Math.random() * quotes.length)].trim();
                display.textContent = randomQuote;
                display.style.opacity = 0.8;
            }, 500);
        }

        function showModal(id) {
            const task = tasks.find(t => t.id === id);
            const body = document.getElementById('modal-body');
            body.innerHTML = `
                <h2 style="margin-bottom: 1rem; color: var(--accent);">${task.name}</h2>
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; color: var(--text-secondary); font-size: 0.9rem;">
                    <span>M√¥n: ${task.subject}</span>
                    <span>H·∫°n: ${task.date} ${task.time ? `-${task.time}` : ''}</span>
                </div>
                ${task.image ? `<img src="${task.image}" style="width: 100%; border-radius: 1rem; margin-bottom: 1.5rem; box-shadow: 0 10px 20px rgba(0,0,0,0.3);">` : ''}
                <p style="white-space: pre-wrap; line-height: 1.6; color: var(--text-main); font-size: 1.1rem;">${task.content || "Kh√¥ng c√≥ n·ªôi dung chi ti·∫øt."}</p>
            `;
            document.getElementById('taskModal').style.display = 'flex';
            playSound('click');
        }

        function closeModal() {
            document.getElementById('taskModal').style.display = 'none';
        }

        function closeWelcome() {
            playSound('success');
            const overlay = document.getElementById('welcomeOverlay');
            overlay.style.opacity = '0';
            overlay.style.pointerEvents = 'none';
            sessionStorage.setItem('welcomeShown', 'true');
            setTimeout(() => overlay.style.display = 'none', 800);
        }

        function checkWelcome() {
            if (!sessionStorage.getItem('welcomeShown')) {
                document.getElementById('welcomeOverlay').style.display = 'flex';
            }
        }

        let completionChart = null;
        let subjectChart = null;

        function updateCharts() {
            try {
                if (typeof Chart === 'undefined') {
                    console.warn("Chart.js ch∆∞a t·∫£i xong...");
                    return;
                }

                if (!document.getElementById('stats-tab').classList.contains('active')) return;

                const tasksDone = tasks.filter(t => t.completed).length;
                const tasksPending = tasks.length - tasksDone;

                // Completion Chart
                const ctx1 = document.getElementById('completionChart').getContext('2d');
                if (completionChart) completionChart.destroy();
                completionChart = new Chart(ctx1, {
                    type: 'doughnut',
                    data: {
                        labels: ['Ho√†n th√†nh', 'ƒêang l√†m'],
                        datasets: [{
                            data: [tasksDone, tasksPending],
                            backgroundColor: ['#10b981', '#6366f1'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'bottom', labels: { color: '#94a3b8' } } }
                    }
                });

                // Subject Chart
                const subjectMap = {};
                tasks.forEach(t => {
                    const sub = t.subject || "Chung";
                    subjectMap[sub] = (subjectMap[sub] || 0) + 1;
                });

                const ctx2 = document.getElementById('subjectChart').getContext('2d');
                if (subjectChart) subjectChart.destroy();
                subjectChart = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(subjectMap),
                        datasets: [{
                            label: 'S·ªë b√†i t·∫≠p',
                            data: Object.values(subjectMap),
                            backgroundColor: '#6366f1',
                            borderRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } },
                            x: { grid: { display: false }, ticks: { color: '#94a3b8' } }
                        },
                        plugins: { legend: { display: false } }
                    }
                });

                // Summary Text
                const summary = document.getElementById('productivitySummary');
                if (summary) {
                    if (tasks.length === 0) {
                        summary.innerHTML = "H√£y th√™m b√†i t·∫≠p ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√¢n t√≠ch nƒÉng su·∫•t nh√©! üöÄ";
                    } else {
                        const percent = Math.round((tasksDone / tasks.length) * 100);
                        let msg = `VanQuanDev: B·∫°n ƒë√£ ho√†n th√†nh <strong>${percent}%</strong> c√¥ng vi·ªác. `;
                        if (percent >= 80) msg += "Tuy·ªát v·ªùi! B·∫°n ƒëang c·ª±c k·ª≥ chƒÉm ch·ªâ. üî•";
                        else if (percent >= 50) msg += "C·ªë g·∫Øng th√™m ch√∫t n·ªØa ƒë·ªÉ ƒë·∫°t m·ª•c ti√™u nh√©. üí™";
                        else msg += "H√£y t·∫≠p trung ho√†n th√†nh c√°c b√†i t·∫≠p c√≤n l·∫°i nh√©! üöÄ";
                        summary.innerHTML = msg;
                    }
                }
            } catch (e) { console.error("L·ªói v·∫Ω bi·ªÉu ƒë·ªì:", e); }
        }

        function switchTab(tabId) {
            playSound('click');
            // G·ª° active kh·ªèi c√°c n√∫t
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            // G·ª° active kh·ªèi c√°c n·ªôi dung
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Active n√∫t hi·ªán t·∫°i
            // Active n√∫t hi·ªán t·∫°i (Safety Check for window.event)
            const currentEvent = window.event || (typeof event !== 'undefined' ? event : null);
            if (currentEvent && currentEvent.currentTarget) {
                currentEvent.currentTarget.classList.add('active');
            } else {
                // Fallback n·∫øu g·ªçi b·∫±ng code
                const activeBtn = document.querySelector(`.tab-btn[onclick*="${tabId}"]`);
                if (activeBtn) activeBtn.classList.add('active');
            }
            // Hi·ªÉn th·ªã tab content
            document.getElementById(tabId + '-tab').classList.add('active');

            // C·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì n·∫øu v√†o tab stats
            if (tabId === 'stats') {
                setTimeout(updateCharts, 100);
            }
        }

        function setDefaultDate() {
            // ...
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            document.getElementById('dueDate').value = `${year}-${month}-${day}`;
        }

        // Particles VIP (Updated Config from TrungTamMMO)
        setTimeout(() => {
            if (typeof particlesJS === 'function' && document.getElementById('particles-js')) {
                particlesJS("particles-js", {
                    "particles": {
                        "number": {
                            "value": 80,
                            "density": { "enable": true, "value_area": 800 }
                        },
                        "color": { "value": "#38b6ff" },
                        "shape": {
                            "type": "circle",
                            "stroke": { "width": 0, "color": "#000000" },
                            "polygon": { "nb_sides": 5 }
                        },
                        "opacity": {
                            "value": 0.5,
                            "random": true,
                            "anim": { "enable": true, "speed": 1, "opacity_min": 0.1, "sync": false }
                        },
                        "size": {
                            "value": 3,
                            "random": true,
                            "anim": { "enable": true, "speed": 2, "size_min": 0.1, "sync": false }
                        },
                        "line_linked": {
                            "enable": true,
                            "distance": 150,
                            "color": "#38b6ff",
                            "opacity": 0.2,
                            "width": 1
                        },
                        "move": {
                            "enable": true,
                            "speed": 1,
                            "direction": "none",
                            "random": true,
                            "straight": false,
                            "out_mode": "out",
                            "bounce": false,
                            "attract": { "enable": true, "rotateX": 600, "rotateY": 1200 }
                        }
                    },
                    "interactivity": {
                        "detect_on": "canvas",
                        "events": {
                            "onhover": { "enable": true, "mode": "grab" },
                            "onclick": { "enable": true, "mode": "push" },
                            "resize": true
                        },
                        "modes": {
                            "grab": { "distance": 140, "line_linked": { "opacity": 0.5 } },
                            "bubble": { "distance": 400, "size": 40, "duration": 2, "opacity": 8, "speed": 3 },
                            "repulse": { "distance": 200, "duration": 0.4 },
                            "push": { "particles_nb": 4 },
                            "remove": { "particles_nb": 2 }
                        }
                    },
                    "retina_detect": true
                });
            }
        }, 500);

        // ========== USER SETTINGS MODAL ==========
        function openSettings() {
            const user = users.find(u => u.username === currentUser);
            if (!user) return;

            // Pre-fill current values
            document.getElementById('settingsDisplayName').value = user.displayName || user.username;
            document.getElementById('settingsAvatarUrl').value = user.avatarUrl || '';
            document.getElementById('settingsBgUrl').value = user.bgUrl || '';

            // Clear password fields
            document.getElementById('settingsOldPassword').value = '';
            document.getElementById('settingsNewPassword').value = '';
            document.getElementById('settingsConfirmPassword').value = '';

            const modal = document.getElementById('settingsModal');
            modal.style.display = 'flex'; // Quay l·∫°i Flexbox Center chu·∫©n
            playSound('click');
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
            playSound('click');
        }

        function updatePersonalInfo() {
            // ƒê·∫£m b·∫£o l·∫•y ƒë√∫ng danh s√°ch user m·ªõi nh·∫•t
            try {
                const savedUsers = localStorage.getItem('hw_users');
                if (savedUsers) users = JSON.parse(savedUsers);
            } catch (e) { console.error("L·ªói ƒë·ªìng b·ªô danh s√°ch user:", e); }

            const userIndex = users.findIndex(u => u.username === currentUser);
            if (userIndex === -1) return showOTPModal("‚ùå Kh√¥ng t√¨m th·∫•y th√¥ng tin ng∆∞·ªùi d√πng!", "‚ö†Ô∏è L·ªói");

            const newName = document.getElementById('settingsDisplayName').value.trim();
            const newAvatarUrl = document.getElementById('settingsAvatarUrl').value.trim();
            const newBgUrl = document.getElementById('settingsBgUrl').value.trim();

            if (!newName) return showOTPModal("‚ùå T√™n hi·ªÉn th·ªã kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!", "‚ö†Ô∏è L·ªói");

            // C·∫≠p nh·∫≠t th√¥ng tin n√≤ng c·ªët
            users[userIndex].displayName = newName;
            users[userIndex].avatarUrl = newAvatarUrl;
            users[userIndex].bgUrl = newBgUrl;

            // L∆∞u vƒ©nh vi·ªÖn v√†o LocalStorage
            localStorage.setItem('hw_users', JSON.stringify(users));
            console.log("‚úÖ ƒê√£ l∆∞u c·∫•u h√¨nh ng∆∞·ªùi d√πng:", users[userIndex]);

            // C·∫≠p nh·∫≠t giao di·ªán ngay l·∫≠p t·ª©c
            updateProfileDisplay();

            playSound('success');
            showOTPModal("‚úÖ ƒê√£ c·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n th√†nh c√¥ng!<br>Th√¥ng tin ƒë√£ ƒë∆∞·ª£c l∆∞u vƒ©nh vi·ªÖn tr√™n tr√¨nh duy·ªát n√†y.", "üéâ Th√†nh C√¥ng");
        }

        function updatePassword() {
            const user = users.find(u => u.username === currentUser);
            if (!user) return showOTPModal("‚ùå Kh√¥ng t√¨m th·∫•y th√¥ng tin ng∆∞·ªùi d√πng!", "‚ö†Ô∏è L·ªói");

            const oldPass = document.getElementById('settingsOldPassword').value;
            const newPass = document.getElementById('settingsNewPassword').value;
            const confirmPass = document.getElementById('settingsConfirmPassword').value;

            // Validate old password
            if (oldPass !== user.password) {
                return showOTPModal("‚ùå M·∫≠t kh·∫©u hi·ªán t·∫°i kh√¥ng ƒë√∫ng!", "‚ö†Ô∏è L·ªói");
            }

            // Validate new password
            if (!newPass || newPass.length < 6) {
                return showOTPModal("‚ùå M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!", "‚ö†Ô∏è L·ªói");
            }

            // Check password complexity: 1 uppercase, 1 lowercase, 1 number
            const hasUppercase = /[A-Z]/.test(newPass);
            const hasLowercase = /[a-z]/.test(newPass);
            const hasNumber = /[0-9]/.test(newPass);

            if (!hasUppercase || !hasLowercase || !hasNumber) {
                return showOTPModal("‚ùå M·∫≠t kh·∫©u ph·∫£i bao g·ªìm √≠t nh·∫•t:<br>‚Ä¢ 1 ch·ªØ HOA<br>‚Ä¢ 1 ch·ªØ th∆∞·ªùng<br>‚Ä¢ 1 s·ªë", "‚ö†Ô∏è L·ªói");
            }

            // Confirm password match
            if (newPass !== confirmPass) {
                return showOTPModal("‚ùå M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng tr√πng kh·ªõp!", "‚ö†Ô∏è L·ªói");
            }

            // Update password
            user.password = newPass;
            localStorage.setItem('hw_users', JSON.stringify(users));

            // Clear fields
            document.getElementById('settingsOldPassword').value = '';
            document.getElementById('settingsNewPassword').value = '';
            document.getElementById('settingsConfirmPassword').value = '';

            playSound('success');
            showOTPModal("‚úÖ ƒê√£ ƒë·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng! Vui l√≤ng ghi nh·ªõ m·∫≠t kh·∫©u m·ªõi.", "üéâ Th√†nh C√¥ng");
        }

        function updateProfileDisplay() {
            const user = users.find(u => u.username === currentUser);
            if (!user) return;

            const displayName = user.displayName || user.username;
            const avatarUrl = user.avatarUrl;
            const bgUrl = user.bgUrl;

            // Update header
            document.getElementById('headerUsername').textContent = displayName;

            // Update Avatar
            const avatarEl = document.getElementById('userAvatar');
            if (avatarUrl) {
                avatarEl.style.backgroundImage = `url('${avatarUrl}')`;
                avatarEl.style.backgroundSize = 'cover';
                avatarEl.style.backgroundPosition = 'center';
                avatarEl.textContent = '';
            } else {
                avatarEl.style.backgroundImage = 'none';
                avatarEl.textContent = displayName.charAt(0).toUpperCase();
            }

            // Update Background Persistent
            const bgLayer = document.getElementById('bgLayer');
            if (bgLayer) {
                if (bgUrl) {
                    bgLayer.style.backgroundImage = `url('${bgUrl}')`;
                    bgLayer.style.display = 'block';
                    bgLayer.style.opacity = '1';
                } else {
                    bgLayer.style.backgroundImage = "url('background.jpg')";
                    bgLayer.style.display = 'block';
                    bgLayer.style.opacity = '0.3'; // M·∫∑c ƒë·ªãnh ƒë·ªÉ nh√¨n m·ªù m·ªù cho ƒë·∫πp
                }
            }
        }

        // Hi·ªáu ·ª©ng di chu·ªôt n·ªÅn chuy·ªÉn ƒë·ªông (T·ªëi ∆∞u h√≥a b·∫±ng requestAnimationFrame)
        let mouseX = 0, mouseY = 0;
        let targetX = 0, targetY = 0;

        document.addEventListener('mousemove', (e) => {
            targetX = (e.clientX - window.innerWidth / 2) * 0.015;
            targetY = (e.clientY - window.innerHeight / 2) * 0.015;
        });

        function animateBG() {
            mouseX += (targetX - mouseX) * 0.1;
            mouseY += (targetY - mouseY) * 0.1;
            const bg = document.getElementById('bgLayer');
            if (bg) bg.style.transform = `translate(${mouseX}px, ${mouseY}px)`;
            requestAnimationFrame(animateBG);
        }
        animateBG();

        // H√ÄM KH·ªûI T·∫†O SI√äU C·∫§P (ULTIMATE INIT)
        function masterInit() {
            console.log("üöÄ H·ªá th·ªëng ƒëang kh·ªüi ƒë·ªông...");

            // 1. ƒê·ªìng h·ªì (∆Øu ti√™n h√†ng ƒë·∫ßu ƒë·ªÉ kh√¥ng b·ªã ƒë·ª©ng h√¨nh)
            try {
                updateLiveTime();
                setInterval(updateLiveTime, 1000);
                console.log("‚úÖ ƒê·ªìng h·ªì ƒë√£ s·∫µn s√†ng");
            } catch (e) { console.error("L·ªói kh·ªüi t·∫°o ƒë·ªìng h·ªì:", e); }

            // 2. Giao di·ªán & Theme
            try {
                const savedTheme = localStorage.getItem('hw_theme');
                if (savedTheme) setTheme(savedTheme, true);
                setInterval(rotateQuote, 10000);
                console.log("‚úÖ Giao di·ªán ƒë√£ s·∫µn s√†ng");
            } catch (e) { console.error("L·ªói theme:", e); }

            // 3. √Çm nh·∫°c & ·ª®ng d·ª•ng
            try {
                initMusic();
                setDefaultDate();
                checkWelcome();
                initApp().then(() => {
                    console.log("‚úÖ ·ª®ng d·ª•ng ƒë√£ kh·ªüi ch·∫°y th√†nh c√¥ng");
                }).catch(e => {
                    console.error("L·ªói InitApp:", e);
                    renderTasks();
                });
            } catch (e) {
                console.error("L·ªói logic nghi·ªáp v·ª•:", e);
                renderTasks();
            }
        }

        // K√≠ch ho·∫°t khi trang ƒë√£ t·∫£i xong
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', masterInit);
        } else {
            masterInit();
        }
        // OTP Modal Logic
        function showOTPModal(message, title) {
            playSound('success');
            const titleElem = document.getElementById('otpModalTitle');
            if (titleElem) titleElem.textContent = title || "üõ°Ô∏è X√°c Th·ª±c B·∫£o M·∫≠t";
            document.getElementById('otpModalMessage').innerHTML = message;
            document.getElementById('otpModal').style.display = 'flex';
        }

        function closeOTPModal() {
            playSound('click');
            document.getElementById('otpModal').style.display = 'none';
            document.getElementById('otpInput').focus();
        }

        // Close OTP modal when clicking outside
        window.onclick = function (event) {
            const modal = document.getElementById('taskModal');
            const otpModal = document.getElementById('otpModal');
            if (event.target == modal) {
                closeModal();
            }
            if (event.target == otpModal) {
                closeOTPModal();
            }
        }
    </script>
</body>

</html>