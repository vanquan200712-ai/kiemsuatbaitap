<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω B√†i T·∫≠p Do VanQuan Thi·∫øt K·∫ø</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <style>
        :root {
            --bg-color: #050505;
            --card-bg: rgba(20, 20, 20, 0.82);
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --accent-hover: #4f46e5;
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --glass-border: rgba(255, 255, 255, 0.08);
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        /* VIP Themes */
        body.theme-rose {
            --accent: #ec4899;
            --accent-hover: #db2777;
            --accent-glow: rgba(236, 72, 153, 0.3);
        }

        body.theme-emerald {
            --accent: #10b981;
            --accent-hover: #059669;
            --accent-glow: rgba(16, 185, 129, 0.3);
        }

        body.theme-amber {
            --accent: #f59e0b;
            --accent-hover: #d97706;
            --accent-glow: rgba(245, 158, 11, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Outfit', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 2rem 1rem;
            display: flex;
            justify-content: center;
            overflow-x: hidden;
            position: relative;
        }

        .bg-overlay {
            position: fixed;
            top: -5%;
            left: -5%;
            width: 110%;
            height: 110%;
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            z-index: -1;
            transition: transform 0.15s ease-out;
            pointer-events: none;
        }

        .container {
            width: 100%;
            max-width: 800px;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
        }

        header h1 {
            font-size: 2.5rem;
            font-weight: 600;
            background: linear-gradient(to right, #6366f1, #ec4899);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        header p {
            color: var(--text-secondary);
        }

        /* Input Form */
        .input-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            padding: 2rem;
            border-radius: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .form-group {
            display: grid;
            grid-template-columns: 2fr 1fr 120px 100px;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-row-2 {
            display: flex;
            justify-content: center;
            gap: 1rem;
            align-items: center;
        }

        textarea {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 0.8rem 1rem;
            border-radius: 0.75rem;
            color: white;
            outline: none;
            transition: border-color 0.3s;
            grid-column: span 4;
            resize: vertical;
            min-height: 80px;
        }

        textarea:focus {
            border-color: var(--accent);
        }

        @media (max-width: 600px) {
            .form-group {
                grid-template-columns: 1fr;
            }
        }

        input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 0.8rem 1rem;
            border-radius: 0.75rem;
            color: white;
            outline: none;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: var(--accent);
        }

        button.add-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        button.add-btn:hover {
            background: var(--accent-hover);
            transform: scale(1.02);
        }

        /* Task List */
        .list-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .task-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            padding: 1.2rem 1.5rem;
            border-radius: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .task-info h3 {
            font-size: 1.1rem;
            margin-bottom: 0.2rem;
            transition: color 0.3s;
        }

        .task-info p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .task-image-preview {
            width: 80px;
            height: 60px;
            border-radius: 0.5rem;
            object-fit: cover;
            margin-right: 1rem;
            border: 1px solid var(--glass-border);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .task-image-preview:hover {
            transform: scale(1.1);
        }

        .task-left {
            display: flex;
            align-items: center;
        }

        .image-input-label {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 0.8rem;
            border-radius: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }

        .image-input-label:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent);
        }

        .image-input-label span {
            font-size: 1.2rem;
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
        }

        .search-container {
            margin-bottom: 2rem;
            position: relative;
        }

        .search-input {
            width: 100%;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            padding: 1.2rem 1.5rem;
            border-radius: 1.25rem;
            color: white;
            outline: none;
            backdrop-filter: blur(15px);
            transition: 0.3s;
            font-size: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .search-input:focus {
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-star {
            background: rgba(234, 179, 8, 0.1);
            color: #eab308;
            font-size: 1.2rem;
        }

        .btn-star.active {
            background: #eab308;
            color: black;
        }

        .task-card.starred {
            border: 1px solid rgba(234, 179, 8, 0.5);
            box-shadow: 0 0 20px rgba(234, 179, 8, 0.15);
            background: rgba(30, 25, 10, 0.85);
        }

        /* Dashboard Stats */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            padding: 1.5rem;
            border-radius: 1.25rem;
            text-align: center;
            transition: 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            display: block;
            margin-bottom: 0.2rem;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .progress-container {
            grid-column: span 3;
            background: rgba(255, 255, 255, 0.05);
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--accent), #ec4899);
            width: 0%;
            transition: width 0.8s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }

        .btn-action {
            width: 38px;
            height: 38px;
            border-radius: 0.5rem;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            color: white;
        }

        .btn-done {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .btn-done:hover {
            background: var(--success);
            color: white;
        }

        .btn-delete {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .btn-delete:hover {
            background: var(--danger);
            color: white;
        }

        /* Status Finished */
        .task-card.completed {
            opacity: 0.6;
        }

        .task-card.completed .task-info h3 {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .task-card.completed .btn-done {
            background: var(--success);
            color: white;
        }

        /* Empty State */
        #empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-primary);
            font-weight: 600;
            font-style: italic;
        }

        /* VIP Ultimate Elements */
        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .quote-container {
            text-align: center;
            margin-bottom: 2rem;
            font-style: italic;
            opacity: 0.8;
            font-size: 0.95rem;
            color: var(--accent);
            animation: pulse 4s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.6;
            }

            50% {
                opacity: 1;
            }
        }

        /* Task Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(15px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            padding: 2.5rem;
            border-radius: 2rem;
            max-width: 600px;
            width: 90%;
            position: relative;
            box-shadow: 0 0 50px rgba(99, 102, 241, 0.2);
        }

        .close-modal {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        /* Tabs System */
        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            justify-content: center;
        }

        .tab-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 0.8rem 2rem;
            border-radius: 2rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: 0.3s;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .tab-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Guide Section Styling */
        .guide-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            padding: 2.5rem;
            border-radius: 2rem;
            line-height: 1.8;
        }

        .guide-item {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .guide-item h3 {
            color: var(--accent);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .guide-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .guide-step {
            background: rgba(255, 255, 255, 0.03);
            padding: 1rem;
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Welcome Overlay */
        .welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            z-index: 30000;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: 0.8s ease;
        }

        .welcome-content {
            padding: 3rem;
            max-width: 600px;
            animation: welcomePop 1s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }

        @keyframes welcomePop {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .welcome-content h2 {
            font-size: 1.5rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 1rem;
        }

        .welcome-content h1 {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            background: linear-gradient(to right, #fff, var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .btn-start {
            background: var(--accent);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 3rem;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.4);
        }

        .btn-start:hover {
            transform: scale(1.1);
            box-shadow: 0 0 50px rgba(99, 102, 241, 0.6);
            background: white;
            color: var(--accent);
        }

        /* Pomodoro & Extra Tools */
        .pomodoro-card {
            background: var(--card-bg);
            border: 1px solid var(--accent-glow);
            padding: 1.5rem;
            border-radius: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-around;
            animation: fadeIn 0.8s ease;
        }

        .pomo-time {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: monospace;
            color: var(--accent);
            text-shadow: 0 0 10px var(--accent-glow);
            margin-bottom: 0.5rem;
        }

        .pomo-presets {
            display: flex;
            gap: 5px;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .preset-btn {
            font-size: 0.75rem !important;
            padding: 0.3rem 0.6rem !important;
            opacity: 0.7;
        }

        .preset-btn.active {
            opacity: 1;
            background: var(--accent) !important;
        }

        .pomo-controls button {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            margin: 0 0.2rem;
            cursor: pointer;
            transition: 0.3s;
        }

        .pomo-controls button:hover {
            background: var(--accent);
        }

        .badge-urgent {
            background: #ef4444;
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 0.5rem;
            font-size: 0.7rem;
            font-weight: 700;
            margin-left: 0.5rem;
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        .theme-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 2rem;
        }

        .theme-dot {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            transition: 0.3s;
        }

        .theme-dot:hover {
            transform: scale(1.2);
        }

        .backup-tools {

            .admin-table th,
            .admin-table td {
                padding: 1.2rem;
                text-align: left;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }

            .admin-table th {
                background: rgba(255, 255, 255, 0.05);
                color: var(--accent);
                text-transform: uppercase;
                font-size: 0.8rem;
                letter-spacing: 1px;
            }

            .admin-table tr:hover {
                background: rgba(255, 255, 255, 0.02);
            }

            .role-badge {
                padding: 0.2rem 0.6rem;
                border-radius: 0.5rem;
                font-size: 0.7rem;
                font-weight: 700;
            }

            .role-admin {
                background: var(--accent);
                color: white;
            }

            .role-user {
                background: rgba(255, 255, 255, 0.1);
                color: var(--text-secondary);
            }

            .btn-delete-user {
                background: rgba(239, 68, 68, 0.1);
                color: var(--danger);
                border: 1px solid var(--danger);
                padding: 0.4rem 0.8rem;
                border-radius: 0.5rem;
                cursor: pointer;
                transition: 0.3s;
            }

            .btn-delete-user:hover {
                background: var(--danger);
                color: white;
            }
        }

        /* Auth Portal */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(15px);
            z-index: 20000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .auth-card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            padding: 3rem;
            border-radius: 2.5rem;
            width: calc(100% - 2rem);
            max-width: 400px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: welcomePop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .auth-card h2 {
            margin-bottom: 2rem;
            font-size: 1.8rem;
            background: linear-gradient(to right, #fff, var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .auth-input {
            width: 100%;
            display: block;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 1rem 1.2rem;
            border-radius: 1rem;
            color: white;
            margin-bottom: 1rem;
            outline: none;
            transition: 0.3s;
            text-align: left;
        }

        .auth-input:focus {
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .auth-toggle {
            margin-top: 1.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .auth-toggle span {
            color: var(--accent);
            cursor: pointer;
            text-decoration: underline;
            font-weight: 600;
        }

        .password-wrapper {
            position: relative;
            width: 100%;
            margin-bottom: 1rem;
        }

        .password-wrapper .auth-input {
            margin-bottom: 0;
            padding-right: 3.5rem;
        }

        .toggle-password {
            position: absolute;
            right: 1.2rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            transition: 0.3s;
            user-select: none;
            z-index: 5;
        }

        .toggle-password:hover {
            color: var(--accent);
        }

        /* User Profile VIP */
        .user-profile {
            position: fixed;
            top: 1.5rem;
            right: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.6rem 1.2rem;
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 5rem;
            z-index: 15000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-left: 3px solid var(--accent);
        }

        .user-profile:hover {
            background: rgba(30, 30, 30, 0.8);
            transform: scale(1.05) translateY(-2px);
            border-color: var(--accent);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.2);
        }

        .avatar {
            width: 38px;
            height: 38px;
            background: linear-gradient(135deg, var(--accent), #ec4899);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px var(--accent-glow);
            flex-shrink: 0;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        #headerUsername {
            font-weight: 700;
            font-size: 0.85rem;
            color: white;
            white-space: nowrap;
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 0.7rem;
            cursor: pointer;
            padding: 0;
            text-align: left;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: 0.3s;
            font-weight: 600;
            margin-top: 2px;
        }

        .logout-btn:hover {
            color: var(--danger);
            letter-spacing: 1.5px;
        }

        @media (max-width: 600px) {
            .user-profile {
                top: 1rem;
                right: 1rem;
                padding: 0.5rem 1rem;
            }

            #headerUsername {
                display: none;
            }

            .user-profile:hover #headerUsername {
                display: block;
            }
        }

        /* Music Toggle VIP */
        .music-control {
            position: fixed;
            top: 6rem;
            right: 2rem;
            width: 48px;
            height: 48px;
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 15000;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            color: white;
            font-size: 1.2rem;
        }

        .music-control:hover {
            transform: scale(1.1);
            background: rgba(40, 40, 40, 0.8);
            border-color: var(--accent);
            box-shadow: 0 0 20px var(--accent-glow);
        }

        .music-control.playing {
            border-color: var(--accent);
            animation: pulse-music 2s infinite;
        }

        @keyframes pulse-music {
            0% {
                box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(99, 102, 241, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(99, 102, 241, 0);
            }
        }

        .music-waves {
            display: none;
            gap: 2px;
            align-items: flex-end;
            height: 12px;
            margin-left: 2px;
        }

        .playing .music-waves {
            display: flex;
        }

        .music-waves span {
            width: 2px;
            background: var(--accent);
            border-radius: 1px;
            animation: wave 1s ease-in-out infinite;
        }

        .music-waves span:nth-child(2) {
            height: 100%;
            animation-delay: 0.2s;
        }

        .music-waves span:nth-child(1) {
            height: 60%;
            animation-delay: 0.1s;
        }

        .music-waves span:nth-child(3) {
            height: 80%;
            animation-delay: 0.3s;
        }

        @keyframes wave {

            0%,
            100% {
                transform: scaleY(1);
            }

            50% {
                transform: scaleY(0.4);
            }
        }

        @media (max-width: 600px) {
            .music-control {
                top: 5rem;
                right: 1.2rem;
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>

<body>
    <!-- Auth Portal -->
    <div id="authPortal" class="auth-overlay" style="display: none;">
        <div class="auth-card" id="loginForm">
            <h2>ƒêƒÉng Nh·∫≠p VIP</h2>
            <input type="text" id="loginUser" class="auth-input" placeholder="T√™n ƒëƒÉng nh·∫≠p...">
            <div class="password-wrapper">
                <input type="password" id="loginPass" class="auth-input" placeholder="M·∫≠t kh·∫©u...">
                <span class="toggle-password" onclick="togglePassword('loginPass', this)">üëÅÔ∏è</span>
            </div>
            <div style="text-align: right; margin-bottom: 1.5rem; margin-top: -0.5rem;">
                <span
                    style="color: var(--text-secondary); font-size: 0.85rem; cursor: pointer; text-decoration: underline;"
                    onclick="toggleAuth('forgot')">Qu√™n m·∫≠t kh·∫©u?</span>
            </div>
            <button class="btn-start" style="width: 100%;" onclick="handleLogin()">ƒêƒÉng Nh·∫≠p</button>
            <div class="auth-toggle">Ch∆∞a c√≥ t√†i kho·∫£n? <span onclick="toggleAuth('register')">ƒêƒÉng k√Ω ngay</span></div>
        </div>
        <div class="auth-card" id="registerForm" style="display: none;">
            <h2>ƒêƒÉng K√Ω Th√†nh Vi√™n</h2>
            <input type="text" id="regUser" class="auth-input" placeholder="T√™n ƒëƒÉng nh·∫≠p...">
            <input type="email" id="regEmail" class="auth-input" placeholder="Email nh·∫≠n m√£ b·∫£o m·∫≠t...">
            <div class="password-wrapper">
                <input type="password" id="regPass" class="auth-input" placeholder="M·∫≠t kh·∫©u b·∫£o m·∫≠t...">
                <span class="toggle-password" onclick="togglePassword('regPass', this)">üëÅÔ∏è</span>
            </div>
            <div class="password-wrapper">
                <input type="password" id="regConfirmPass" class="auth-input" placeholder="X√°c nh·∫≠n l·∫°i m·∫≠t kh·∫©u...">
                <span class="toggle-password" onclick="togglePassword('regConfirmPass', this)">üëÅÔ∏è</span>
            </div>
            <button class="btn-start" style="width: 100%;" onclick="handleRegister()">T·∫°o T√†i Kho·∫£n</button>
            <div class="auth-toggle">ƒê√£ c√≥ t√†i kho·∫£n? <span onclick="toggleAuth('login')">Quay l·∫°i ƒêƒÉng nh·∫≠p</span>
            </div>
        </div>
        <div class="auth-card" id="forgotForm" style="display: none;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üîë</div>
            <h2>Kh√¥i Ph·ª•c M·∫≠t Kh·∫©u</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9rem;">
                Nh·∫≠p Email b·∫°n ƒë√£ d√πng ƒë·ªÉ ƒëƒÉng k√Ω t√†i kho·∫£n.
            </p>
            <input type="email" id="forgotEmail" class="auth-input" placeholder="Email c·ªßa b·∫°n...">
            <button class="btn-start" style="width: 100%;" onclick="handleForgotPassword()">G·ª≠i M√£ X√°c Th·ª±c</button>
            <div class="auth-toggle" onclick="toggleAuth('login')"><span>Quay l·∫°i ƒêƒÉng nh·∫≠p</span></div>
        </div>
        <div class="auth-card" id="resetForm" style="display: none;">
            <h2>ƒê·∫∑t L·∫°i M·∫≠t Kh·∫©u</h2>
            <div class="password-wrapper">
                <input type="password" id="newPass" class="auth-input" placeholder="M·∫≠t kh·∫©u m·ªõi...">
                <span class="toggle-password" onclick="togglePassword('newPass', this)">üëÅÔ∏è</span>
            </div>
            <div class="password-wrapper">
                <input type="password" id="confirmNewPass" class="auth-input" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi...">
                <span class="toggle-password" onclick="togglePassword('confirmNewPass', this)">üëÅÔ∏è</span>
            </div>
            <button class="btn-start" style="width: 100%;" onclick="handleResetPassword()">C·∫≠p Nh·∫≠t M·∫≠t Kh·∫©u</button>
        </div>
        <div class="auth-card" id="verifyForm" style="display: none;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üõ°Ô∏è</div>
            <h2>X√°c Th·ª±c B·∫£o M·∫≠t</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9rem;" id="verifyMsg">
                M√£ x√°c th·ª±c ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n.
            </p>
            <input type="text" id="otpInput" class="auth-input" placeholder="Nh·∫≠p m√£ 6 ch·ªØ s·ªë..." maxlength="6"
                style="text-align: center; letter-spacing: 5px; font-weight: 700;">
            <button class="btn-start" style="width: 100%;" onclick="confirmOTP()">X√°c Nh·∫≠n</button>
            <div class="auth-toggle">C·∫£nh b√°o: ƒê√¢y l√† d·ª± √°n b·∫£o m·∫≠t VIP c·ªßa Qu√¢n</div>
        </div>
    </div>

    <!-- Welcome Overlay -->
    <div id="welcomeOverlay" class="welcome-overlay" style="display: none;">
        <div class="welcome-content">
            <h2>üéâ D·ª± √Ån ƒê·∫ßu Tay</h2>
            <h1>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi d·ª± √°n ƒë·∫ßu ti√™n c·ªßa Nguy·ªÖn VƒÉn Qu√¢n</h1>
            <p style="color: var(--text-secondary); margin-bottom: 3rem; line-height: 1.6;">
                Kh√°m ph√° ·ª©ng d·ª•ng qu·∫£n l√Ω b√†i t·∫≠p ƒë·∫≥ng c·∫•p VIP v·ªõi nh·ªØng t√≠nh nƒÉng ƒë·ªôc b·∫£n v√† giao di·ªán si√™u hi·ªán th·ª±c.
            </p>
            <button class="btn-start" onclick="closeWelcome()">Kh√°m Ph√° Ngay</button>
        </div>
    </div>

    <div id="particles-js"></div>
    <div class="bg-overlay" id="bgLayer"></div>

    <div class="user-profile" id="userHeader" style="display: none;" title="Qu·∫£n l√Ω t√†i kho·∫£n VIP">
        <div class="avatar" id="userAvatar">Q</div>
        <div class="user-info">
            <span id="headerUsername">Nguy·ªÖn VƒÉn Qu√¢n</span>
            <button class="logout-btn" onclick="handleLogout()">ƒêƒÉng xu·∫•t</button>
        </div>
    </div>

    <!-- Music Toggle VIP -->
    <div class="music-control" id="musicToggle" onclick="toggleMusic()" title="B·∫≠t/T·∫Øt nh·∫°c Lofi Chill">
        <span id="musicIcon">üîá</span>
        <div class="music-waves">
            <span></span><span></span><span></span>
        </div>
    </div>
    <audio id="bgMusic" loop onplay="console.log('Music started playing')" onerror="handleAudioError()">
        <source src="https://www.chosic.com/wp-content/uploads/2021/04/Lofi-Chill.mp3" type="audio/mpeg">
        <source src="https://pixabay.com/vi/music/nh%e1%bb%8bp-%c4%91%e1%ba%adp-lofi-chill-372954/" type="audio/mpeg">
    </audio>

    <script>
        function handleAudioError() {
            console.error("Kh√¥ng th·ªÉ t·∫£i nh·∫°c n·ªÅn lofi.");
            // Silent fail or alert for debugging if needed
        }
    </script>

    <div class="container" id="mainApp">
        <header>
            <p id="greeting-text"
                style="color: var(--accent); font-weight: 600; text-transform: uppercase; letter-spacing: 2px; font-size: 0.9rem; margin-bottom: 0.5rem;">
            </p>
            <h1>Qu·∫£n L√Ω B√†i T·∫≠p Do VanQuan Thi·∫øt K·∫ø</h1>
            <div id="live-clock"
                style="font-size: 1.5rem; color: #fff; font-weight: 700; margin-bottom: 0.2rem; text-shadow: 0 0 15px rgba(99, 102, 241, 0.5);">
                00:00:00</div>
            <p id="live-date" style="font-size: 1rem; opacity: 0.8; margin-bottom: 1.5rem;">ƒêANG T·∫¢I...</p>
        </header>

        <div class="quote-container" id="quote-display">
            "H·ªçc t·∫≠p l√† h·∫°t gi·ªëng c·ªßa ki·∫øn th·ª©c, ki·∫øn th·ª©c l√† h·∫°t gi·ªëng c·ªßa h·∫°nh ph√∫c."
        </div>

        <nav class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('manager')">üìã Qu·∫£n L√Ω</button>
            <button class="tab-btn" onclick="switchTab('guide')">üìñ H∆∞·ªõng D·∫´n</button>
            <button class="tab-btn" id="adminTabBtn" style="display: none;" onclick="switchTab('admin')">‚öôÔ∏è Qu·∫£n
                Tr·ªã</button>
        </nav>

        <div id="manager-tab" class="tab-content active">
            <section class="pomodoro-card">
                <div style="text-align: center;">
                    <span
                        style="font-size: 0.8rem; text-transform: uppercase; color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Pomodoro
                        Focus</span>
                    <div class="pomo-presets">
                        <button class="tab-btn preset-btn active" onclick="setPomoDuration(25, this)">25p</button>
                        <button class="tab-btn preset-btn" onclick="setPomoDuration(45, this)">45p</button>
                        <button class="tab-btn preset-btn" onclick="setPomoDuration(60, this)">60p</button>
                        <input type="number" id="customPomo" placeholder="Ph√∫t..."
                            style="width: 70px; background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border); color: white; border-radius: 0.5rem; padding: 2px 8px; font-size: 0.8rem;"
                            oninput="setPomoDuration(this.value, null)">
                    </div>
                    <div class="pomo-time" id="pomoDisplay">25:00</div>
                    <div class="pomo-controls">
                        <button onclick="togglePomo()" id="pomoStartBtn">B·∫ÆT ƒê·∫¶U</button>
                        <button onclick="resetPomo()">RESET</button>
                    </div>
                </div>
            </section>

            <section class="input-card">
                <div class="form-group">
                    <input type="text" id="taskName" placeholder="T√™n b√†i t·∫≠p..." required>
                    <input type="text" id="subject" placeholder="M√¥n h·ªçc (VƒÉn, To√°n...)">
                    <input type="date" id="dueDate">
                    <input type="time" id="dueTime">
                    <textarea id="taskContent" placeholder="N·ªôi dung chi ti·∫øt b√†i t·∫≠p..."></textarea>
                </div>
                <div class="form-row-2">
                    <label class="image-input-label" title="Th√™m ·∫£nh">
                        <span>üì∑</span>
                        <input type="file" id="imageInput" accept="image/*" style="display: none;">
                    </label>
                    <button class="add-btn" onclick="addTask()">Th√™m B√†i</button>
                </div>
            </section>

            <section class="dashboard-grid" id="stats-section">
                <div class="stat-card">
                    <span class="stat-value" id="stat-total">0</span>
                    <span class="stat-label">T·ªïng b√†i</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-done" style="color: var(--success);">0</span>
                    <span class="stat-label">Ho√†n th√†nh</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-percent" style="color: var(--accent);">0%</span>
                    <span class="stat-label">Ti·∫øn ƒë·ªô</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="main-progress"></div>
                </div>
            </section>

            <section class="search-container">
                <input type="text" id="searchInput" class="search-input"
                    placeholder="üîç T√¨m ki·∫øm b√†i t·∫≠p ho·∫∑c m√¥n h·ªçc..." oninput="renderTasks()">
            </section>

            <section id="taskList" class="list-container">
                <!-- B√†i t·∫≠p s·∫Ω hi·ªán ·ªü ƒë√¢y -->
            </section>

            <div id="empty-state" style="display: none;">
                B·∫°n ch∆∞a c√≥ b√†i t·∫≠p n√†o. H√£y th√™m m·ªôt b√†i ·ªü tr√™n nh√©!
            </div>
        </div>

        <div id="guide-tab" class="tab-content">
            <section class="guide-card">
                <h2 style="text-align: center; margin-bottom: 2rem; font-size: 2rem;">üìñ H∆∞·ªõng D·∫´n S·ª≠ D·ª•ng VIP</h2>

                <div class="guide-item">
                    <h3>‚ö° Th√™m B√†i T·∫≠p Nhanh</h3>
                    <p>Nh·∫≠p t√™n b√†i t·∫≠p, m√¥n h·ªçc v√† ch·ªçn ng√†y h·∫°n. B·∫°n c√≥ th·ªÉ th√™m n·ªôi dung chi ti·∫øt ho·∫∑c ƒë√≠nh k√®m ·∫£nh
                        b·∫±ng c√°ch b·∫•m v√†o bi·ªÉu t∆∞·ª£ng üì∑.</p>
                </div>

                <div class="guide-item">
                    <h3>‚≠ê Ch·∫ø ƒê·ªô ∆Øu Ti√™n (Star)</h3>
                    <p>B·∫•m v√†o bi·ªÉu t∆∞·ª£ng ng√¥i sao ƒë·ªÉ ƒë∆∞a b√†i t·∫≠p ƒë√≥ l√™n v·ªã tr√≠ ƒë·∫ßu ti√™n. Nh·ªØng b√†i ƒë∆∞·ª£c g·∫Øn sao s·∫Ω c√≥
                        hi·ªáu ·ª©ng t·ªèa s√°ng ƒë·∫∑c bi·ªát ƒë·ªÉ b·∫°n kh√¥ng bao gi·ªù b·ªè l·ª°.</p>
                </div>

                <div class="guide-item">
                    <h3>üìä Theo D√µi Ti·∫øn ƒê·ªô</h3>
                    <div class="guide-grid">
                        <div class="guide-step">
                            <strong>T·ªïng b√†i:</strong> ƒê·∫øm t·∫•t c·∫£ nhi·ªám v·ª• b·∫°n ƒë√£ t·∫°o.
                        </div>
                        <div class="guide-step">
                            <strong>Ho√†n th√†nh:</strong> S·ªë nhi·ªám v·ª• ƒë√£ ƒë∆∞·ª£c ƒë√°nh d·∫•u xong.
                        </div>
                        <div class="guide-step">
                            <strong>Ti·∫øn ƒë·ªô:</strong> Thanh ph·∫ßn trƒÉm t·ª± ƒë·ªông c·∫≠p nh·∫≠t t√¢m tr·∫°ng h·ªçc t·∫≠p c·ªßa b·∫°n.
                        </div>
                    </div>
                </div>

                <div class="guide-item">
                    <h3>üîç T√¨m Ki·∫øm Th√¥ng Minh</h3>
                    <p>S·ª≠ d·ª•ng thanh t√¨m ki·∫øm ƒë·ªÉ l·ªçc b√†i t·∫≠p theo T√™n ho·∫∑c M√¥n h·ªçc ngay l·∫≠p t·ª©c. Danh s√°ch s·∫Ω t·ª± ƒë·ªông
                        thu nh·ªè theo √Ω b·∫°n mu·ªën.</p>
                </div>

                <div class="guide-item" style="border-bottom: none;">
                    <h3>üñ±Ô∏è T∆∞∆°ng T√°c VIP</h3>
                    <ul>
                        <li><strong>Click v√†o b√†i t·∫≠p:</strong> M·ªü c·ª≠a s·ªï Focus xem chi ti·∫øt n·ªôi dung v√† ·∫£nh l·ªõn.</li>
                        <li><strong>Ph√°o hoa:</strong> B·∫Øn tung t√≥e m·ªói khi b·∫°n ho√†n th√†nh m·ªôt b√†i t·∫≠p!</li>
                        <li><strong>√Çm thanh:</strong> T∆∞∆°ng t√°c s·ªëng ƒë·ªông v·ªõi ph·∫£n h·ªìi √¢m thanh cao c·∫•p.</li>
                    </ul>
                </div>
            </section>
            <!-- Adding Theme Selector and Backup to the end of Guide or separate footer -->
            <section class="guide-card" style="margin-top: 2rem; text-align: center;">
                <h3>üé® T√πy Ch·ªânh Giao Di·ªán VIP</h3>
                <div class="theme-selector">
                    <div class="theme-dot" style="background: #6366f1;" onclick="setTheme('default')"
                        title="Indigo Neon"></div>
                    <div class="theme-dot" style="background: #ec4899;" onclick="setTheme('rose')" title="Rose Gold">
                    </div>
                    <div class="theme-dot" style="background: #10b981;" onclick="setTheme('emerald')"
                        title="Emerald Green"></div>
                    <div class="theme-dot" style="background: #f59e0b;" onclick="setTheme('amber')" title="Royal Gold">
                    </div>
                </div>

                <div class="backup-tools"
                    style="margin-top: 2rem; border-top: 1px solid var(--glass-border); padding-top: 1.5rem;">
                    <button class="btn-link" onclick="exportData()">üíæ Sao l∆∞u d·ªØ li·ªáu (Export)</button>
                    <button class="btn-link" onclick="document.getElementById('importFile').click()">üìÇ Kh√¥i ph·ª•c d·ªØ
                        li·ªáu (Import)</button>
                    <input type="file" id="importFile" style="display: none;" onchange="importData(event)">
                </div>
            </section>
        </div>

        <div id="admin-tab" class="tab-content">
            <section class="guide-card">
                <h2 style="text-align: center; margin-bottom: 2rem; font-size: 2rem;">‚öôÔ∏è H·ªá Th·ªëng Qu·∫£n Tr·ªã T·ªëi Cao</h2>
                <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem;">
                    Ch√†o Admin <strong>Nguy·ªÖn VƒÉn Qu√¢n</strong>, b√™n d∆∞·ªõi l√† danh s√°ch to√†n b·ªô ng∆∞·ªùi d√πng trong h·ªá
                    th·ªëng.
                </p>
                <div style="overflow-x: auto;">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Ng∆∞·ªùi d√πng</th>
                                <th>Email</th>
                                <th>Quy·ªÅn h·∫°n</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="userListBody"></tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>
    <!-- Modal Xem Chi Ti·∫øt -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // Authentication Logic
        let users = JSON.parse(localStorage.getItem('hw_users')) || [];

        // Seed Admin Account if not exists
        if (!users.find(u => u.username === 'admin')) {
            users.push({
                username: 'admin',
                password: 'admin123',
                email: 'admin@viquan.vip',
                role: 'admin'
            });
            localStorage.setItem('hw_users', JSON.stringify(users));
        }

        let currentUser = sessionStorage.getItem('current_user');
        let recoveryUser = null; // To track user being reset
        let recoveryMode = false; // Is the OTP for login or reset?

        let isMusicPlaying = localStorage.getItem('music_enabled') === 'true';
        const bgMusic = document.getElementById('bgMusic');
        const musicToggle = document.getElementById('musicToggle');
        const musicIcon = document.getElementById('musicIcon');

        function toggleMusic() {
            if (isMusicPlaying) {
                bgMusic.pause();
                musicIcon.textContent = 'üîá';
                musicToggle.classList.remove('playing');
                isMusicPlaying = false;
            } else {
                bgMusic.play().catch(e => console.log("Audio play blocked: ", e));
                musicIcon.textContent = 'üéµ';
                musicToggle.classList.add('playing');
                isMusicPlaying = true;
            }
            localStorage.setItem('music_enabled', isMusicPlaying);
            playSound('click');
        }

        // Auto-play if enabled (handling browser constraints)
        window.addEventListener('click', () => {
            if (isMusicPlaying && bgMusic.paused) {
                bgMusic.play().catch(() => { });
                musicIcon.textContent = 'üéµ';
                musicToggle.classList.add('playing');
            }
        }, { once: true });

        if (isMusicPlaying) {
            musicIcon.textContent = 'üéµ';
            musicToggle.classList.add('playing');
        }

        function togglePassword(inputId, icon) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'üôà';
            } else {
                input.type = 'password';
                icon.textContent = 'üëÅÔ∏è';
            }
            playSound('click');
        }

        function toggleAuth(mode) {
            playSound('click');
            const forms = ['loginForm', 'registerForm', 'forgotForm', 'resetForm', 'verifyForm'];
            forms.forEach(f => document.getElementById(f).style.display = 'none');

            if (mode === 'register') document.getElementById('registerForm').style.display = 'block';
            else if (mode === 'forgot') document.getElementById('forgotForm').style.display = 'block';
            else if (mode === 'reset') document.getElementById('resetForm').style.display = 'block';
            else if (mode === 'login') document.getElementById('loginForm').style.display = 'block';
        }

        function handleRegister() {
            const user = document.getElementById('regUser').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const pass = document.getElementById('regPass').value.trim();
            const confirmPass = document.getElementById('regConfirmPass').value.trim();

            if (!user || !email || !pass || !confirmPass) return alert("Vui l√≤ng nh·∫≠p ƒë·ªß c√°c tr∆∞·ªùng th√¥ng tin!");

            if (pass !== confirmPass) return alert("‚ùå M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng tr√πng kh·ªõp!");

            if (users.find(u => u.username === user)) return alert("T√™n t√†i kho·∫£n n√†y ƒë√£ c√≥ ng∆∞·ªùi d√πng!");

            users.push({
                username: user,
                password: pass,
                email: email,
                role: 'user'
            }); // Default role to 'user'
            localStorage.setItem('hw_users', JSON.stringify(users));
            playSound('success');
            alert("‚ú® ƒêƒÉng k√Ω th√†nh c√¥ng! H√£y d√πng t√†i kho·∫£n n√†y ƒë·ªÉ ƒëƒÉng nh·∫≠p.");
            toggleAuth('login');
        }

        let currentOTP = "";
        let pendingUser = null;

        function handleForgotPassword() {
            const email = document.getElementById('forgotEmail').value.trim();
            const user = users.find(u => u.email === email);

            if (!user) return alert("‚ùå Email n√†y ch∆∞a ƒë∆∞·ª£c ƒëƒÉng k√Ω trong h·ªá th·ªëng!");

            playSound('success');
            recoveryUser = user.username;
            recoveryMode = true;
            currentOTP = Math.floor(100000 + Math.random() * 900000).toString();

            document.getElementById('forgotForm').style.display = 'none';
            document.getElementById('verifyForm').style.display = 'block';
            document.getElementById('verifyMsg').innerHTML = `M√£ kh√¥i ph·ª•c ƒë√£ ƒë∆∞·ª£c g·ª≠i t·ªõi:<br><strong style="color:var(--accent)">${email}</strong><br>(M√£ demo: <span style="cursor:pointer" onclick="alert('M√£ c·ªßa b·∫°n l√†: ' + currentOTP)">${currentOTP}</span>)`;
        }

        function handleResetPassword() {
            const pass = document.getElementById('newPass').value;
            const confirm = document.getElementById('confirmNewPass').value;

            if (!pass || pass !== confirm) return alert("‚ùå M·∫≠t kh·∫©u m·ªõi kh√¥ng tr√πng kh·ªõp ho·∫∑c tr·ªëng!");

            users = users.map(u => u.username === recoveryUser ? {
                ...u,
                password: pass
            } : u);
            localStorage.setItem('hw_users', JSON.stringify(users));
            playSound('success');
            alert("‚úÖ ƒê√£ c·∫≠p nh·∫≠t m·∫≠t kh·∫©u m·ªõi! B·∫°n c√≥ th·ªÉ ƒëƒÉng nh·∫≠p ngay.");
            toggleAuth('login');
        }

        function handleLogin() {
            const user = document.getElementById('loginUser').value.trim();
            const pass = document.getElementById('loginPass').value.trim();

            const found = users.find(u => u.username === user && u.password === pass);
            if (found) {
                // B∆∞·ªõc x√°c th·ª±c 2 l·ªõp gi·∫£ l·∫≠p
                playSound('success');
                pendingUser = user;
                recoveryMode = false;
                currentOTP = Math.floor(100000 + Math.random() * 900000).toString();

                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('verifyForm').style.display = 'block';
                document.getElementById('verifyMsg').innerHTML = `M√£ b·∫£o m·∫≠t ƒë√£ ƒë∆∞·ª£c g·ª≠i t·ªõi:<br><strong style="color:var(--accent)">${found.email}</strong><br>(M√£ demo: <span style="cursor:pointer" onclick="alert('M√£ c·ªßa b·∫°n l√†: ' + currentOTP)">${currentOTP}</span>)`;

                alert(`üõ°Ô∏è [B·∫¢O M·∫¨T] M·ªôt m√£ x√°c th·ª±c (${currentOTP}) ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email ${found.email}. H√£y nh·∫≠p m√£ ƒë·ªÉ ti·∫øp t·ª•c.`);
            } else {
                alert("‚ùå Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!");
            }
        }

        function confirmOTP() {
            const input = document.getElementById('otpInput').value.trim();
            if (input === currentOTP) {
                playSound('success');
                document.getElementById('otpInput').value = "";

                if (recoveryMode) {
                    document.getElementById('verifyForm').style.display = 'none';
                    document.getElementById('resetForm').style.display = 'block';
                } else {
                    sessionStorage.setItem('current_user', pendingUser);
                    currentUser = pendingUser;
                    initApp();
                    // Reset form x√°c th·ª±c
                    document.getElementById('verifyForm').style.display = 'none';
                }
            } else {
                alert("‚ùå M√£ x√°c th·ª±c kh√¥ng ch√≠nh x√°c. Vui l√≤ng ki·ªÉm tra l·∫°i!");
            }
        }

        function handleLogout() {
            playSound('delete');
            sessionStorage.removeItem('current_user');
            location.reload();
        }

        function initApp() {
            if (!currentUser) {
                document.getElementById('authPortal').style.display = 'flex';
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('verifyForm').style.display = 'none';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('userHeader').style.display = 'none';
            } else {
                document.getElementById('authPortal').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('userHeader').style.display = 'flex';
                document.getElementById('headerUsername').textContent = currentUser;
                document.getElementById('userAvatar').textContent = currentUser[0].toUpperCase();

                // Admin specific logic
                const userObj = users.find(u => u.username === currentUser);
                if (userObj && userObj.role === 'admin') {
                    document.getElementById('adminTabBtn').style.display = 'block';
                    renderUsers();
                } else {
                    document.getElementById('adminTabBtn').style.display = 'none';
                }

                renderTasks();
            }
        }

        function renderUsers() {
            const tbody = document.getElementById('userListBody');
            tbody.innerHTML = users.map(u => `
                <tr>
                    <td><strong>${u.username}</strong></td>
                    <td>${u.email}</td>
                    <td><span class="role-badge ${u.role === 'admin' ? 'role-admin' : 'role-user'}">${u.role === 'admin' ? 'ADMIN' : 'USER'}</span></td>
                    <td>
                        ${u.role !== 'admin' ? `<button class="btn-delete-user" onclick="deleteUser('${u.username}')">X√≥a</button>` : '---'}
                    </td>
                </tr>
            `).join('');
        }

        function deleteUser(username) {
            if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a vƒ©nh vi·ªÖn t√†i kho·∫£n "${username}" kh√¥ng?`)) {
                playSound('delete');
                users = users.filter(u => u.username !== username);
                localStorage.setItem('hw_users', JSON.stringify(users));
                renderUsers();
                alert(`‚úÖ ƒê√£ x√≥a t√†i kho·∫£n "${username}" th√†nh c√¥ng.`);
            }
        }

        // Legendary Tools Logic
        let pomoMinutes = 25;
        let pomoSeconds = 0;
        let isPomoRunning = false;
        let basePomoMinutes = 25;
        let pomoInterval;

        function setPomoDuration(mins, btn) {
            playSound('click');
            const newMins = parseInt(mins);
            if (isNaN(newMins) || newMins <= 0) {
                // alert("Vui l√≤ng nh·∫≠p s·ªë ph√∫t h·ª£p l·ªá cho Pomodoro."); // Removed alert for better UX on input
                return;
            }
            basePomoMinutes = newMins;
            resetPomo();

            document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
            if (btn) {
                btn.classList.add('active');
                document.getElementById('customPomo').value = ''; // Clear custom input if a preset is clicked
            } else {
                // If custom input was used, ensure no preset button is active
                // and potentially highlight the custom input or indicate it's active
            }
        }

        function togglePomo() {
            playSound('click');
            if (isPomoRunning) {
                clearInterval(pomoInterval);
                document.getElementById('pomoStartBtn').textContent = "TI·∫æP T·ª§C";
            } else {
                pomoInterval = setInterval(updatePomo, 1000);
                document.getElementById('pomoStartBtn').textContent = "T·∫†M D·ª™NG";
            }
            isPomoRunning = !isPomoRunning;
        }

        function resetPomo() {
            playSound('click');
            clearInterval(pomoInterval);
            isPomoRunning = false;
            pomoMinutes = basePomoMinutes;
            pomoSeconds = 0;
            const m = String(pomoMinutes).padStart(2, '0');
            document.getElementById('pomoDisplay').textContent = `${m}:00`;
            document.getElementById('pomoStartBtn').textContent = "B·∫ÆT ƒê·∫¶U";
        }

        function updatePomo() {
            if (pomoSeconds === 0) {
                if (pomoMinutes === 0) {
                    clearInterval(pomoInterval);
                    playSound('success');
                    alert("üïí H·∫øt th·ªùi gian t·∫≠p trung! H√£y ngh·ªâ ng∆°i m·ªôt l√°t.");
                    resetPomo();
                    return;
                }
                pomoMinutes--;
                pomoSeconds = 59;
            } else {
                pomoSeconds--;
            }
            const m = String(pomoMinutes).padStart(2, '0');
            const s = String(pomoSeconds).padStart(2, '0');
            document.getElementById('pomoDisplay').textContent = `${m}:${s}`;
        }

        function setTheme(theme) {
            playSound('click');
            document.body.className = theme === 'default' ? '' : `theme-${theme}`;
            localStorage.setItem('hw_theme', theme);
        }

        function exportData() {
            playSound('click');
            const blob = new Blob([JSON.stringify(tasks)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `VanQuan_Homework_Backup_${new Date().toLocaleDateString()}.json`;
            a.click();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                tasks = JSON.parse(e.target.result);
                saveAndRender();
                playSound('success');
                alert("üìÇ ƒê√£ kh√¥i ph·ª•c d·ªØ li·ªáu th√†nh c√¥ng!");
            };
            reader.readAsText(file);
        }

        // √Çm thanh VIP
        const sounds = {
            click: new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3'),
            success: new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3'),
            delete: new Audio('https://assets.mixkit.co/active_storage/sfx/2619/2619-preview.mp3')
        };
        sounds.click.volume = 0.3;
        sounds.success.volume = 0.4;
        sounds.delete.volume = 0.3;

        function playSound(type) {
            sounds[type].currentTime = 0;
            sounds[type].play().catch(() => { });
        }
        let tasks = JSON.parse(localStorage.getItem('hw_tasks')) || [];

        function saveAndRender() {
            localStorage.setItem('hw_tasks', JSON.stringify(tasks));
            renderTasks();
        }

        function addTask() {
            playSound('click');
            const name = document.getElementById('taskName').value;
            const subject = document.getElementById('subject').value || "Ch∆∞a ph√¢n lo·∫°i";
            const date = document.getElementById('dueDate').value || "Kh√¥ng c√≥ h·∫°n";
            const time = document.getElementById('dueTime').value || ""; // Get time value
            const content = document.getElementById('taskContent').value;
            const imageInput = document.getElementById('imageInput');
            const imageFile = imageInput.files[0];

            if (!name) return alert("Vui l√≤ng nh·∫≠p t√™n b√†i t·∫≠p!");

            const proceedWithTask = (base64Img = null) => {
                const newTask = {
                    id: Date.now(),
                    name: name,
                    subject: subject,
                    date: date,
                    time: time, // Add time to the task object
                    content: content,
                    completed: false,
                    starred: false,
                    image: base64Img
                };

                tasks.unshift(newTask);
                document.getElementById('taskName').value = "";
                document.getElementById('subject').value = "";
                document.getElementById('dueDate').value = "";
                document.getElementById('dueTime').value = ""; // Clear time input
                document.getElementById('taskContent').value = "";
                imageInput.value = ""; // Reset file input

                saveAndRender();
            };

            if (imageFile) {
                const reader = new FileReader();
                reader.onload = (e) => proceedWithTask(e.target.result);
                reader.readAsDataURL(imageFile);
            } else {
                proceedWithTask();
            }
        }

        function toggleTask(id) {
            tasks = tasks.map(task => {
                if (task.id === id) {
                    const willComplete = !task.completed;
                    if (willComplete) {
                        playSound('success');
                        // Hi·ªáu ·ª©ng ph√°o hoa Elite
                        confetti({
                            particleCount: 150,
                            spread: 70,
                            origin: { y: 0.6 },
                            colors: ['#6366f1', '#ec4899', '#ffffff']
                        });
                    }
                    return { ...task, completed: willComplete };
                }
                return task;
            });
            saveAndRender();
        }

        function toggleStar(id) {
            tasks = tasks.map(task =>
                task.id === id ? { ...task, starred: !task.starred } : task
            );
            saveAndRender();
        }

        function deleteTask(id) {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b√†i t·∫≠p n√†y kh√¥ng?")) {
                playSound('delete');
                tasks = tasks.filter(task => task.id !== id);
                saveAndRender();
            }
        }

        function renderTasks() {
            const list = document.getElementById('taskList');
            const empty = document.getElementById('empty-state');
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();

            list.innerHTML = "";

            let filteredTasks = tasks.filter(task =>
                task.name.toLowerCase().includes(searchQuery) ||
                task.subject.toLowerCase().includes(searchQuery)
            );

            // S·∫Øp x·∫øp: G·∫Øn sao l√™n ƒë·∫ßu, r·ªìi ƒë·∫øn b√†i m·ªõi nh·∫•t
            filteredTasks.sort((a, b) => {
                if (a.starred === b.starred) return 0;
                return a.starred ? -1 : 1;
            });

            if (filteredTasks.length === 0) {
                empty.style.display = "block";
                empty.textContent = searchQuery ? "Kh√¥ng t√¨m th·∫•y b√†i t·∫≠p n√†o kh·ªõp v·ªõi t·ª´ kh√≥a." : "B·∫°n ch∆∞a c√≥ b√†i t·∫≠p n√†o. H√£y th√™m m·ªôt b√†i ·ªü tr√™n nh√©!";
                return;
            } else {
                empty.style.display = "none";
            }

            filteredTasks.forEach((task, index) => {
                const card = document.createElement('div');
                card.className = `task-card ${task.completed ? 'completed' : ''} ${task.starred ? 'starred' : ''}`;
                card.style.animationDelay = `${index * 0.1}s`;

                // Logic Kh·∫©n C·∫•p
                let urgentHtml = "";
                const today = new Date();
                const taskDate = new Date(task.date);
                const diffTime = taskDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (!task.completed && diffDays >= 0 && diffDays <= 1) {
                    urgentHtml = `<span class="badge-urgent">KH·∫®N C·∫§P</span>`;
                }

                const imageHtml = task.image ? `<img src="${task.image}" class="task-image-preview" onclick="window.open('${task.image}')" title="B·∫•m ƒë·ªÉ xem ·∫£nh l·ªõn">` : '';
                const contentHtml = task.content ? `<p style="margin-top: 0.5rem; color: var(--text-dim); font-size: 0.9rem; white-space: pre-wrap;">${task.content}</p>` : '';

                card.innerHTML = `
                    <div class="task-left" onclick="showModal(${task.id})">
                        ${imageHtml}
                        <div class="task-info">
                            <h3>${task.starred ? '‚≠ê ' : ''}${task.name} ${urgentHtml}</h3>
                            <p>M√¥n: ${task.subject} ‚Ä¢ H·∫°n: ${task.date} ${task.time ? `(${task.time})` : ''}</p>
                            ${contentHtml}
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="btn-action btn-star ${task.starred ? 'active' : ''}" onclick="event.stopPropagation(); toggleStar(${task.id})" title="∆Øu ti√™n">
                            ${task.starred ? '‚òÖ' : '‚òÜ'}
                        </button>
                        <button class="btn-action btn-done" onclick="event.stopPropagation(); toggleTask(${task.id})" title="Ho√†n th√†nh">
                            ‚úì
                        </button>
                        <button class="btn-action btn-delete" onclick="event.stopPropagation(); deleteTask(${task.id})" title="X√≥a">
                            ‚úï
                        </button>
                    </div>
                `;
                list.appendChild(card);
            });

            updateStats();
        }

        function updateStats() {
            const total = tasks.length;
            const done = tasks.filter(t => t.completed).length;
            const percent = total === 0 ? 0 : Math.round((done / total) * 100);

            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-done').textContent = done;
            document.getElementById('stat-percent').textContent = `${percent}%`;
            document.getElementById('main-progress').style.width = `${percent}%`;
        }

        function updateLiveTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('vi-VN');
            const dateStr = now.toLocaleDateString('vi-VN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

            document.getElementById('live-clock').textContent = timeStr;
            document.getElementById('live-date').textContent = dateStr;

            // Update Greeting
            const hour = now.getHours();
            let greeting = "";
            if (hour >= 5 && hour < 12) greeting = "üåÖ Ch√†o bu·ªïi s√°ng r·∫°ng r·ª°";
            else if (hour >= 12 && hour < 18) greeting = "‚òÄÔ∏è Ch√†o bu·ªïi chi·ªÅu nƒÉng l∆∞·ª£ng";
            else if (hour >= 18 && hour < 22) greeting = "üåô Ch√†o bu·ªïi t·ªëi b√¨nh y√™n";
            else greeting = "üåå L√†m vi·ªác khuya r·ªìi, ngh·ªâ ng∆°i th√¥i";
            document.getElementById('greeting-text').textContent = greeting;
        }

        const quotes = [
            "H√†nh tr√¨nh v·∫°n d·∫∑m b·∫Øt ƒë·∫ßu t·ª´ m·ªôt b∆∞·ªõc ch√¢n.",
            "Th√†nh c√¥ng l√† k·∫øt qu·∫£ c·ªßa s·ª± chu·∫©n b·ªã m·ªói ng√†y.",
            "H√£y l√†m vi·ªác khi ng∆∞·ªùi kh√°c ƒëang ng·ªß.",
            "H√¥m nay chƒÉm ch·ªâ, mai n√†y th√™nh thang.",
            "Ki·∫øn th·ª©c l√† s·ª©c m·∫°nh, th·ª±c h√†nh l√† ch√¨a kh√≥a."
        ];

        function rotateQuote() {
            const display = document.getElementById('quote-display');
            display.style.opacity = 0;
            setTimeout(() => {
                display.textContent = `"${quotes[Math.floor(Math.random() * quotes.length)]}"`;
                display.style.opacity = 0.8;
            }, 500);
        }

        function showModal(id) {
            const task = tasks.find(t => t.id === id);
            const body = document.getElementById('modal-body');
            body.innerHTML = `
                <h2 style="margin-bottom: 1rem; color: var(--accent);">${task.name}</h2>
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; color: var(--text-secondary); font-size: 0.9rem;">
                    <span>M√¥n: ${task.subject}</span>
                    <span>H·∫°n: ${task.date} ${task.time ? `-${task.time}` : ''}</span>
                </div>
                ${task.image ? `<img src="${task.image}" style="width: 100%; border-radius: 1rem; margin-bottom: 1.5rem; box-shadow: 0 10px 20px rgba(0,0,0,0.3);">` : ''}
                <p style="white-space: pre-wrap; line-height: 1.6; color: var(--text-main); font-size: 1.1rem;">${task.content || "Kh√¥ng c√≥ n·ªôi dung chi ti·∫øt."}</p>
            `;
            document.getElementById('taskModal').style.display = 'flex';
            playSound('click');
        }

        function closeModal() {
            document.getElementById('taskModal').style.display = 'none';
        }

        function closeWelcome() {
            playSound('success');
            const overlay = document.getElementById('welcomeOverlay');
            overlay.style.opacity = '0';
            overlay.style.pointerEvents = 'none';
            sessionStorage.setItem('welcomeShown', 'true');
            setTimeout(() => overlay.style.display = 'none', 800);
        }

        function checkWelcome() {
            if (!sessionStorage.getItem('welcomeShown')) {
                document.getElementById('welcomeOverlay').style.display = 'flex';
            }
        }

        function switchTab(tabId) {
            // ...
            playSound('click');
            // G·ª° active kh·ªèi c√°c n√∫t
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            // G·ª° active kh·ªèi c√°c n·ªôi dung
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Active n√∫t hi·ªán t·∫°i
            event.currentTarget.classList.add('active');
            // Hi·ªÉn th·ªã tab content
            document.getElementById(tabId + '-tab').classList.add('active');
        }

        function setDefaultDate() {
            // ...
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            document.getElementById('dueDate').value = `${year}-${month}-${day}`;
        }

        // Particles VIP
        setTimeout(() => {
            particlesJS("particles-js", {
                "particles": {
                    "number": { "value": 80 },
                    "color": { "value": "#6366f1" },
                    "shape": { "type": "circle" },
                    "opacity": { "value": 0.3 },
                    "size": { "value": 3 },
                    "line_linked": { "enable": true, "distance": 150, "color": "#6366f1", "opacity": 0.2, "width": 1 },
                    "move": { "enable": true, "speed": 2 }
                },
                "interactivity": {
                    "events": { "onhover": { "enable": true, "mode": "grab" } }
                }
            });
        }, 500);

        // Hi·ªáu ·ª©ng di chu·ªôt n·ªÅn chuy·ªÉn ƒë·ªông (T·ªëi ∆∞u h√≥a b·∫±ng requestAnimationFrame)
        let mouseX = 0, mouseY = 0;
        let targetX = 0, targetY = 0;

        document.addEventListener('mousemove', (e) => {
            targetX = (e.clientX - window.innerWidth / 2) * 0.015;
            targetY = (e.clientY - window.innerHeight / 2) * 0.015;
        });

        function animateBG() {
            mouseX += (targetX - mouseX) * 0.1;
            mouseY += (targetY - mouseY) * 0.1;
            const bg = document.getElementById('bgLayer');
            if (bg) bg.style.transform = `translate(${mouseX}px, ${mouseY}px)`;
            requestAnimationFrame(animateBG);
        }
        animateBG();

        // Kh·ªüi t·∫°o ban ƒë·∫ßu
        const savedTheme = localStorage.getItem('hw_theme');
        if (savedTheme) setTheme(savedTheme);

        setInterval(updateLiveTime, 1000);
        setInterval(rotateQuote, 10000);
        updateLiveTime();
        setDefaultDate();
        checkWelcome();
        initApp();
    </script>
</body>

</html>